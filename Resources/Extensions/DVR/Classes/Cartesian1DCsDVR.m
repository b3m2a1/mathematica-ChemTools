(* ::Package:: *)

(************************************************************************)
(* This file was generated automatically by the Mathematica front end.  *)
(* It contains Initialization cells from a Notebook file, which         *)
(* typically will have the same name as this file except ending in      *)
(* ".nb" instead of ".m".                                               *)
(*                                                                      *)
(* This file is intended to be loaded into the Mathematica kernel using *)
(* the package loading commands Get or Needs.  Doing so is equivalent   *)
(* to using the Evaluate Initialization Cells menu command in the front *)
(* end.                                                                 *)
(*                                                                      *)
(* DO NOT EDIT THIS FILE.  This entire file is regenerated              *)
(* automatically each time the parent Notebook file is saved in the     *)
(* Mathematica front end.  Any changes you make to this file will be    *)
(* overwritten.                                                         *)
(************************************************************************)



ChemDVRBegin[];


$Cartesian1DCsDVR::usage="";


Cartesian1DCsDVRFormatGrid::usage="";
Cartesian1DCsDVRPoints::usage="";
Cartesian1DCsDVRKineticMatrix::usage=""
Cartesian1DCsDVRPotentialMatrix::usage=""
Cartesian1DCsDVRWavefunctions::usage=""
Cartesian1DCsDVRPlotFunction::usage=""


ChemDVRNeeds@"Cartesian1DDVR"


Begin["`Private`"];


Cartesian1DCsDVRPoints[
	points:{_Integer},
	X:{{_?NumericQ,_?NumericQ}}
	]:=
	With[{
		realPts=2
		},
		Take[
			Cartesian1DDVRPoints[
				points*2,
				X
				],
			points[[1]]
			]
		]


Options[Cartesian1DCsDVRKineticMatrix]=
	{
		"M"->1,
		"\[HBar]"->1
		};


Cartesian1DCsDVRKineticMatrix[grid_,ops:OptionsPattern[]]:=
	With[{xmin=Min@grid,xmax=Max@grid,points=Length@grid},
		With[{dx=(xmax-xmin)/points,m=OptionValue@"M",\[HBar]=OptionValue@"\[HBar]"},
			With[{
				f1=
					Compile[
						{{i, _Integer}, {j, _Integer}, {p, _Integer}},
						1./Sqrt[2]*(\[HBar] (-1)^(i-j))/(2.m dx^2)*
							(
								If[i==j,
									\[Pi]^2/3.,
									2/(i-j)^2
									]+2./( i + j - ( 2*p +1 ))^2
								)
						],
				f2=
					Compile[
						{{i, _Integer}, {j, _Integer}, {p, _Integer}},
						1./Sqrt[2]*(\[HBar] (-1)^(i-j))/(2m dx^2)*
							(
								If[i==j,
									\[Pi]^2/3.,
									2./(i-j)^2
									]-2./( i + j - ( 2*p +1 ))^2
								)
						],
				head=
					If[points>100000, ParallelTable, Table]
				},
				{
					head[
						f1[i, j, points],
						{i, points},
						{j, points}
						],
					head[
						f2[i, j, points],
						{i, points, 1, -1},
						{j, points, 1, -1}
						]
					}
				]
			]
		]


Options[Cartesian1DCsDVRPotentialMatrix]=
	{Function->((#/2)^2&)};
Cartesian1DCsDVRPotentialMatrix[grid_,ops:OptionsPattern[]]:=
	With[{func=OptionValue@Function},
		With[{A=func/@grid},
			{
				DiagonalMatrix@A,
				DiagonalMatrix@Reverse@A
				}
			]
		]


Options[Cartesian1DCsDVRWavefunctions]=
	Options[ChemDVRDefaultWavefunctions];
Cartesian1DCsDVRWavefunctions[
	T_, V_,
	ops:OptionsPattern[]
	]:=
	With[{
		chunks=
			MapThread[
				ChemDVRDefaultWavefunctions[
					#, 
					#2,
					ops
					]&,
				{T, V}
				]
		},
		With[{
			riff=
			{
				Riffle@@chunks[[All ,1]],
				MapIndexed[
					Join@@
					If[OddQ[#2[[1]]],
						{ Reverse[#], # },
						{ #, -Reverse[#]}
						]&,
					Riffle@@chunks[[All, 2]]
					]
				}
			},
			If[OptionValue["SortEnergies"]=!=False,
				#[[{1,2}, Ordering[First@#]]]&@riff,
				riff
				]
			]
		]


Options[Cartesian1DCsDVRPlotFunction]=
	Options[Cartesian1DDVRPlotFunction]
Cartesian1DCsDVRPlotFunction[
	solutions_,
	grid_,
	potentialMatrices_,
	ops:OptionsPattern[]
	]:=
	Cartesian1DDVRPlotFunction[
		solutions,
		Join[
			grid,
			-Reverse[grid]
			],
		DiagonalMatrix@
			Join[
				Diagonal@potentialMatrices[[1]],
				Diagonal@potentialMatrices[[2]]
				],
		ops
		]


End[];


$Cartesian1DCsDVR=
	<|
		"Name"->"Symmetric Cartesian 1D",
		"Dimension"->1,
		"PointLabels"->{"x"|"y"|"z"},
		"Range"->{{-5,5}},
		"Grid"->Cartesian1DCsDVRPoints,
		"KineticEnergy"->Cartesian1DCsDVRKineticMatrix,
		"PotentialEnergy"->Cartesian1DCsDVRPotentialMatrix,
		"Wavefunctions"->Cartesian1DCsDVRWavefunctions,
		"View"->Cartesian1DCsDVRPlotFunction
		|>


ChemDVREnd[];


$Cartesian1DCsDVR



