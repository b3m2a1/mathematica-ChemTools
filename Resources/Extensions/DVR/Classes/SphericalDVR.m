(* ::Package:: *)

(* Autogenerated Package *)

ChemDVRBegin[];


SphericalDVRK::usage="Returns the disk DVR kinetic energy matrix";


Begin["`Private`"];


(* ::Text:: *)
(*
	Pulled straight from CM
*)



Options[SphericalDVRK]=
	{
		"HBar"->1,
		"Mass"->1,
		"ScalingFactor"->1,
		"MeshSpacing"->Automatic,
		Precision->MachinePrecision,
		"KineticEnergyElementFunction"->Automatic
		};
SphericalDVRK[grid_, ops:OptionsPattern[]]:=
	Module[
		{
			rgrid=grid[[All, 1, 1, 1]],
			qgrid=grid[[1, All, 1, 2]],
			jgrid=grid[[1, 1, All, 3]],
			rpoints,
			qpoints,
			jpoints,
			rops=Replace[Flatten@{ops}, (k_->{r_, ___}):>(k->r), 1],
			qops=Replace[Flatten@{ops}, (k_->{_, q_, ___}):>(k->q), 1],
			jops=Replace[Flatten@{ops}, (k_->{_, _, j_, ___}):>(k->j), 1],
			rke,
			qke,
			jke,
			ke,
			hb=Replace[OptionValue["HBar"], {{_, _, _, h_, ___}:>h, l_List:>Mean[l]}],
			m=Replace[OptionValue["Mass"], {{_, _, _, h_, ___}:>h, l_List:>Mean[l]}],
			sf=Replace[OptionValue["ScalingFactor"], {{_, _, _, h_, ___}:>h, l_List:>Mean[l]}],
			eke,
			rg2,
			sj2
			},
			rke=ChemDVRDefaultKineticEnergy[rgrid, rops];
			qke=ChemDVRDefaultKineticEnergy[qgrid, qops];
			jke=ChemDVRDefaultKineticEnergy[jgrid, qops];
			rpoints=Length@rgrid;
			qpoints=Length@qgrid;
			jpoints=Length@jgrid;
			rg2=rgrid^2;
			sj2=Sin[jgrid]^2;
			jke=
				KroneckerProduct[
					jke,
					IdentityMatrix[qpoints, SparseArray],
					SparseArray[Band[{1, 1}]->1/rg2]
					];
			qke=
				KroneckerProduct[
					SparseArray[Band[{1, 1}]->1/sj2],
					qke,
					SparseArray[Band[{1, 1}]->1/rg2]
					];
			rke=
				KroneckerProduct[
					IdentityMatrix[jpoints, SparseArray],
					IdentityMatrix[qpoints, SparseArray],
					rke
					];
			eke=
				KroneckerProduct[
					SparseArray[
						Band[{1, 1}]->(1+sj2)/sj2
						],
					IdentityMatrix[qpoints, SparseArray],
					SparseArray[
						Band[{1, 1}]->-hb^2/(8*m*rg2)
						]
					];
			Plus[
				rke,
				qke,
				jke,
				eke
				]
		]


End[];


$SphericalDVR=
	<|
		"Name"->"Spherical 3D",
		"Range"->
			N@{{1, 5}, {0, 2\[Pi]}, {0, \[Pi]}},
		"Points"->
			{15, 15, 15},
		"KineticEnergy"->
			SphericalDVRK,
		"Defaults"->
			{
				"GridType"->
					{"RegularSubdivision", "AzimuthalSubdivision", "PolarSubdivision"},
				"KineticEnergyElementFunction"->
					{"ColbertMillerRadial", "ColbertMillerAzimuthal", "ColbertMillerPolar"},
				"PotentialFunction"->
					{
						{"MorseOscillator", "EquilibriumBondLength"->3},
						{"HinderedRotor",   "WellNumber"->3 },
						{"HinderedHalfRotor", "EquilibriumBondLength"->3}
						},
				"PlotMode"->"Spherical"
				}
		|>


ChemDVREnd[];


$SphericalDVR



