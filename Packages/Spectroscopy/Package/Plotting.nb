Notebook[{

Cell[CellGroupData[{
Cell["Spectra", "CodeSection",
 CellChangeTimes->{{3.692619234792058*^9, 
  3.6926192387674026`*^9}},ExpressionUUID->"94f0d441-d035-414d-91d6-\
ddfa26b58e71"],

Cell[CellGroupData[{

Cell["\[LeftCeiling]View\[RightFloor]", "CodeSubsubsection",
 Evaluatable->True,
 CellChangeTimes->{{3.6926192485761757`*^9, 
  3.692619249460898*^9}},ExpressionUUID->"944948c7-13e9-4f04-8350-\
d686bb27072b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ChemSpectrumPlot", "::", "usage"}], "=", 
   "\"\<Plots a spectrum\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ChemSpectrumViewer", "::", "usage"}], "=", "\n", "\t", 
   "\"\<An interactive viewer to focus on pieces of a spectrum\>\""}], 
  ";"}]}], "CodeInput",ExpressionUUID->"bb63fc2e-9aaa-4df4-be1d-924233597705"]\

}, Open  ]],

Cell[CellGroupData[{

Cell["\[LeftCeiling]Selector\[RightFloor]", "CodeSubsubsection",
 Evaluatable->True,
 CellChangeTimes->{{3.6942063882975492`*^9, 
  3.6942063892562532`*^9}},ExpressionUUID->"21b377c4-6cd6-4485-b3e8-\
ae56b5e53ed9"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ChemSpectrumLineStore", "::", "usage"}], "=", "\n", "\t", 
    "\"\<Represents a cache of lines. \nHas HoldFirst and can be used as an \
operator to add to the cache.\>\""}], ";"}], " "}]], "CodeInput",
 CellChangeTimes->{{3.694206392850135*^9, 3.69420641714358*^9}, 
   3.69420649730515*^9, {3.694255730707082*^9, 
   3.694255757239278*^9}},ExpressionUUID->"2a77a7b0-cedc-4345-bf48-\
b59dd9d4f2de"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ChemSpectrumLineSelector", "::", "usage"}], "=", "\n", "\t", 
   "\"\<An interactive spectrum viewer and selector.\nHas stacking, zooming, \
a cursor, and can apply an arbitrary function.\nTo be used with the operator \
form of ChemSpectrumLineStore\>\""}], ";"}]], "CodeInput",
 CellChangeTimes->{{3.6942064203503237`*^9, 3.694206495534031*^9}, 
   3.694255733641173*^9},ExpressionUUID->"1ef12c02-e196-4d54-af06-\
75477b8f5f81"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], 
  ";"}]], "InputSection",ExpressionUUID->"feb5ca9c-1c12-4ed7-a0ff-\
7cac3736862a"],

Cell[CellGroupData[{

Cell["\[LeftCeiling]Viewing\[RightFloor]", "CodeSubsection",
 Evaluatable->True,
 CellChangeTimes->{{3.692542661126648*^9, 
  3.692542662021559*^9}},ExpressionUUID->"3f22d1a5-78bd-4c07-ac53-\
d3f83f64fedb"],

Cell[CellGroupData[{

Cell["Plot", \
"CodeSubsubsection",ExpressionUUID->"b6deea85-aa79-4e81-b081-aec6ca491ea4"],

Cell[CellGroupData[{

Cell["\[LeftCeiling]Continuous\[RightFloor]", "CodeSubsubsubsection",
 Evaluatable->True,
 CellChangeTimes->{{3.6927083576803493`*^9, 
  3.692708363047368*^9}},ExpressionUUID->"e178eed8-ab34-4aeb-b488-\
83b624ec8815"],

Cell[BoxData[
 RowBox[{
  RowBox[{"chemSpectrumPlotContinuous", "[", 
   RowBox[{"spec_", ",", " ", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", "\n", "\t", 
  RowBox[{"ListLinePlot", "[", "\n", "\t\t", 
   RowBox[{
    RowBox[{"spec", "[", "\"\<Points\>\"", "]"}], ",", "\n", "\t\t", 
    RowBox[{"FilterRules", "[", "\n", "\t\t\t", 
     RowBox[{
      RowBox[{"{", "\n", "\t\t\t\t", "ops", "\n", "\t\t\t\t", "}"}], ",", 
      "\n", "\t\t\t", 
      RowBox[{"Options", "@", "ListLinePlot"}]}], "\n", "\t\t\t", "]"}]}], 
   "\n", "\t\t", 
   "]"}]}]], \
"CodeInput",ExpressionUUID->"aac44946-66ff-4846-b302-cb14e47ba8ca"]
}, Open  ]],

Cell[CellGroupData[{

Cell["\[LeftCeiling]Discrete\[RightFloor]", "CodeSubsubsubsection",
 Evaluatable->True,ExpressionUUID->"cfedbcd0-1e3e-4374-8410-5f82b332b96b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "chemSpectrumPlotDiscrete", "]"}], "=", "\n", "\t", 
   RowBox[{"Options", "@", "ListLinePlot"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"chemSpectrumPlotDiscrete", "[", "\n", "\t", 
    RowBox[{"spec_", ",", "\n", "\t", 
     RowBox[{"ops", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "\n", "\t", "]"}], ":=", "\n",
    "\t", 
   RowBox[{"Module", "[", "\n", "\t\t", 
    RowBox[{
     RowBox[{"{", "\n", "\t\t\t", 
      RowBox[{
      "freqs", ",", "\n", "\t\t\t", "pts", ",", "\n", "\t\t\t", "data", ",", 
       "\n", "\t\t\t", "padding"}], "\n", "\t\t\t", "}"}], ",", "\n", "\t\t", 
     
     RowBox[{
      RowBox[{"freqs", "=", 
       RowBox[{"spec", "[", "\"\<Frequencies\>\"", "]"}]}], ";", "\n", "\t\t", 
      RowBox[{"pts", "=", 
       RowBox[{"spec", "[", "\"\<Points\>\"", "]"}]}], ";", "\n", "\t\t", 
      RowBox[{"padding", "=", 
       RowBox[{"Transpose", "[", 
        RowBox[{"{", 
         RowBox[{"freqs", ",", " ", 
          RowBox[{"ConstantArray", "[", 
           RowBox[{"0.", ",", " ", 
            RowBox[{"Length", "@", "freqs"}]}], "]"}]}], "}"}], "]"}]}], ";", 
      "\n", "\t\t", 
      RowBox[{"data", "=", "\n", "\t\t\t", 
       RowBox[{"Riffle", "[", "\n", "\t\t\t\t", 
        RowBox[{
         RowBox[{"Riffle", "[", 
          RowBox[{"padding", ",", " ", "pts"}], "]"}], ",", "\n", "\t\t\t\t", 
         "padding", ",", "\n", "\t\t\t\t", "3"}], "\n", "\t\t\t\t", "]"}]}], 
      ";", "\n", "\t\t", 
      RowBox[{"ListLinePlot", "[", "\n", "\t\t\t", 
       RowBox[{"data", ",", "\n", "\t\t\t", 
        RowBox[{"FilterRules", "[", "\n", "\t\t\t\t", 
         RowBox[{
          RowBox[{"{", "\n", "\t\t\t\t\t", 
           RowBox[{"ops", ",", "\n", "\t\t\t\t\t", 
            RowBox[{"PlotRange", "\[Rule]", "All"}], ",", "\n", "\t\t\t\t\t", 
            
            RowBox[{"PlotStyle", "\[Rule]", "Red"}]}], "\n", "\t\t\t\t\t", 
           "}"}], ",", "\n", "\t\t\t\t", 
          RowBox[{"Options", "@", "ListLinePlot"}]}], "\n", "\t\t\t\t", 
         "]"}]}], "\n", "\t\t\t", "]"}]}]}], "\n", "\t\t", "]"}]}], 
  ";"}]}], \
"CodeInput",ExpressionUUID->"2555089b-2204-4169-880d-7dd0d437e832"]
}, Open  ]],

Cell[CellGroupData[{

Cell["\[LeftCeiling]Distribution\[RightFloor]", "CodeSubsubsubsection",
 Evaluatable->True,ExpressionUUID->"cf646ad2-1c22-4c74-8dcc-5526c8ddef40"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "chemSpectrumPlotDistribution", "]"}], "=", "\n", 
   "\t", 
   RowBox[{"Join", "[", "\n", "\t\t", 
    RowBox[{
     RowBox[{"Options", "[", "Plot", "]"}], ",", "\n", "\t\t", 
     RowBox[{"{", "\n", "\t\t\t", 
      RowBox[{"\"\<DistributionFunction\>\"", "\[Rule]", "Automatic"}], "\n", 
      "\t\t\t", "}"}]}], "\n", "\t\t", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"chemSpectrumPlotDistribution", "[", "\n", "\t", 
   RowBox[{"spec_", ",", "\n", "\t", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "\n", "\t", "]"}], ":=", "\n", 
  "\t", 
  RowBox[{"Module", "[", "\n", "\t\t", 
   RowBox[{
    RowBox[{"{", "\n", "\t\t\t", 
     RowBox[{
      RowBox[{"dist", "=", "\n", "\t\t\t\t", 
       RowBox[{
        RowBox[{"Replace", "[", 
         RowBox[{
          RowBox[{"OptionValue", "[", "\"\<DistributionFunction\>\"", "]"}], 
          ",", " ", "\n", "\t\t\t\t\t", 
          RowBox[{"{", "\n", "\t\t\t\t\t\t", 
           RowBox[{
           "Automatic", "->", "\n", "\t\t\t\t\t\t\t", 
            "ChemSpectrumNormalDistribution"}], "\n", "\t\t\t\t\t\t", "}"}]}],
          "\n", "\t\t\t\t\t", "]"}], "@", "spec"}]}], ",", "\n", "\t\t\t", 
      "pdf", ",", "\n", "\t\t\t", 
      RowBox[{"frange", "=", 
       RowBox[{"spec", "[", "\"\<FrequencyRange\>\"", "]"}]}]}], "\n", 
     "\t\t\t", "}"}], ",", "\n", "\t\t", 
    RowBox[{
     RowBox[{"pdf", "=", 
      RowBox[{"PDF", "[", 
       RowBox[{"dist", ",", " ", "$x"}], "]"}]}], ";", "\n", "\t\t", 
     RowBox[{"Plot", "[", 
      RowBox[{"pdf", ",", "\n", "\t\t\t", 
       RowBox[{"{", 
        RowBox[{"$x", ",", " ", 
         RowBox[{"frange", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
         RowBox[{"frange", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", "\n", "\t\t\t", 
       RowBox[{"Evaluate", "@", 
        RowBox[{"FilterRules", "[", 
         RowBox[{
          RowBox[{"{", "ops", "}"}], ",", " ", 
          RowBox[{"Options", "@", "Plot"}]}], "]"}]}]}], "\n", "\t\t\t", 
      "]"}]}]}], "\n", "\t\t", 
   "]"}]}]}], \
"CodeInput",ExpressionUUID->"b33a8b92-dce3-4ca0-8ff2-1d945815fdbd"]
}, Open  ]],

Cell[CellGroupData[{

Cell["\[LeftCeiling]Plot\[RightFloor]", "CodeSubsubsubsection",
 Evaluatable->True,ExpressionUUID->"76edd7a9-5246-4133-8f47-0630fe9b65be"],

Cell[BoxData[
 RowBox[{"$plotModeMap", "=", "\n", "\t", 
  RowBox[{"<|", "\n", "\t\t", 
   RowBox[{
    RowBox[{"\"\<Continuous\>\"", "\[Rule]", "chemSpectrumPlotContinuous"}], 
    ",", "\n", "\t\t", 
    RowBox[{"\"\<Discrete\>\"", "\[Rule]", "chemSpectrumPlotDiscrete"}], ",", 
    "\n", "\t\t", 
    RowBox[{"\"\<Distribution\>\"", "->", "chemSpectrumPlotDistribution"}]}], 
   "\n", "\t\t", 
   "|>"}]}]], \
"CodeInput",ExpressionUUID->"288fcc1e-e0cb-4bb9-a026-b1cb9d205ba4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ChemSpectrumPlot", "[", 
   RowBox[{"spec_", ",", " ", "\n", "\t", 
    RowBox[{"mode", ":", 
     RowBox[{
      RowBox[{"_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"KeyExistsQ", "[", 
          RowBox[{"$plotModeMap", ",", " ", "#"}], "]"}], "&"}], ")"}]}], "|",
       "Automatic"}], ":", "Automatic"}], ",", "\n", "\t", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "\n", "\t", "]"}], ":=", "\n", 
  "\t", 
  RowBox[{"Module", "[", "\n", "\t\t", 
   RowBox[{
    RowBox[{"{", "\n", "\t\t\t", 
     RowBox[{"fn", "=", "\n", "\t\t\t\t", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"mode", "===", "Automatic"}], ",", "\n", "\t\t\t\t\t", 
        RowBox[{"$plotModeMap", "[", 
         RowBox[{"spec", "[", "\"\<Mode\>\"", "]"}], "]"}], ",", "\n", 
        "\t\t\t\t\t", 
        RowBox[{"$plotModeMap", "[", "mode", "]"}]}], "\n", "\t\t\t\t\t", 
       "]"}]}], "\n", "\t\t\t", "}"}], ",", "\n", "\t\t", 
    RowBox[{"fn", "[", 
     RowBox[{"spec", ",", " ", "ops"}], "]"}]}], "\n", "\t\t", 
   "]"}]}]], \
"CodeInput",ExpressionUUID->"8acd5a79-04a7-4605-adfd-20522cd29add"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["\[LeftCeiling]Viewer\[RightFloor]", "CodeSubsubsection",
 Evaluatable->True,
 CellChangeTimes->{{3.692706447323709*^9, 
  3.692706448370743*^9}},ExpressionUUID->"8a6050e8-714c-455f-bbde-\
af480fb9cdcb"],

Cell["\<\
\[LeftCeiling]
\tNeeds an extension to better the new spectrum handling formats. Add in some \
stuff for Gaussian broadening.
\[RightFloor]\
\>", "Text",
 Evaluatable->True,ExpressionUUID->"a08fe5dc-e1a9-4935-b9e2-fc7a60254e81"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "ChemSpectrumViewer", "]"}], "=", "\n", "\t", 
   RowBox[{"DeleteDuplicatesBy", "[", 
    RowBox[{
     RowBox[{"Join", "[", 
      RowBox[{
       RowBox[{"Options", "@", "ChemSpectrumPlot"}], ",", 
       RowBox[{"Options", "@", "ChemSpectrumPlotDiscrete"}]}], "]"}], ",", 
     "First"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ChemSpectrumViewer", "[", "\n", "\t", 
    RowBox[{"spectrum_ChemSpectrum", ",", "\[IndentingNewLine]", 
     RowBox[{"rangeStart", ":", 
      RowBox[{"{", "\n", "\t\t", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"_Scaled", "|", 
           RowBox[{"_", "?", "NumericQ"}]}], ",", 
          RowBox[{"_Scaled", "|", 
           RowBox[{"_", "?", "NumericQ"}]}]}], "}"}], ",", "\n", "\t\t", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"_Scaled", "|", 
           RowBox[{"_", "?", "NumericQ"}]}], ",", 
          RowBox[{"_Scaled", "|", 
           RowBox[{"_", "?", "NumericQ"}]}]}], "}"}]}], "\n", "\t\t", "}"}], 
      ":", 
      RowBox[{"{", "\n", "\t\t\t", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Scaled", "[", ".25", "]"}], ",", 
          RowBox[{"Scaled", "[", ".75", "]"}]}], "}"}], ",", "\n", "\t\t\t", 
        RowBox[{"{", 
         RowBox[{"0.035", ",", 
          RowBox[{"Scaled", "[", "1", "]"}]}], "}"}]}], "\n", "\t\t\t", 
       "}"}]}], ",", "\n", "\t", 
     RowBox[{"plotFuntion", ":", 
      RowBox[{
      "ChemSpectrumPlot", "|", "ChemSpectrumPlotDiscrete", "|", "Automatic"}],
       ":", "Automatic"}], ",", "\n", "\t", 
     RowBox[{"ops", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", "\n", "\t", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"plotF", "=", "\n", "\t\t", 
       RowBox[{"Replace", "[", 
        RowBox[{"plotFuntion", ",", "\n", "\t\t\t", 
         RowBox[{"Automatic", "\[RuleDelayed]", 
          RowBox[{"Switch", "[", 
           RowBox[{
            RowBox[{"First", "@", "spectrum"}], ",", "_List", ",", 
            "ChemSpectrumPlot", ",", "_", ",", "ChemSpectrumPlotDiscrete"}], 
           "]"}]}]}], "\n", "\t\t\t", "]"}]}], "}"}], ",", "\n", "\t\t\t", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", "\n", "\t\t\t\t", 
        RowBox[{
         RowBox[{"d", "=", 
          RowBox[{"Replace", "[", 
           RowBox[{
            RowBox[{"OptionValue", "@", "ImageSize"}], ",", 
            RowBox[{"{", "\n", "\t\t\t\t\t", 
             RowBox[{
              RowBox[{
               RowBox[{"Large", "|", "Automatic"}], "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"600", ",", 
                 RowBox[{"600", "/", "3"}]}], "}"}]}], ",", "\n", 
              "\t\t\t\t\t", 
              RowBox[{"Small", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"250", ",", 
                 RowBox[{"250", "/", "3"}]}], "}"}]}], ",", "\n", 
              "\t\t\t\t\t", 
              RowBox[{
               RowBox[{"e", ":", 
                RowBox[{"{", 
                 RowBox[{"_", ",", "_"}], "}"}]}], "\[RuleDelayed]", "e"}], 
              ",", "\n", "\t\t\t\t\t", 
              RowBox[{"_", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"150", ",", 
                 RowBox[{"150", "/", "3"}]}], "}"}]}]}], "\n", "\t\t\t\t\t", 
             "}"}]}], "]"}]}], ",", "\n", "\t\t\t\t", 
         RowBox[{"R", "=", 
          RowBox[{"Range", "@", "spectrum"}]}], ",", "\n", "\t\t\t\t", 
         RowBox[{"M", "=", 
          RowBox[{"MinMax", "@", "spectrum"}]}]}], "}"}], ",", "\n", 
       "\t\t\t\t\t", 
       RowBox[{"With", "[", 
        RowBox[{
         RowBox[{"{", "\n", "\t", "\t\t\t\t\t", 
          RowBox[{
           RowBox[{"rMinS", "=", "\n", "\t", "\t\t\t\t\t\t", 
            RowBox[{"Max", "@", 
             RowBox[{"{", "\n", "\t", "\t\t\t\t\t\t\t\t", 
              RowBox[{
               RowBox[{"Replace", "[", 
                RowBox[{
                 RowBox[{"rangeStart", "[", 
                  RowBox[{"[", 
                   RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
                 RowBox[{
                  RowBox[{"Scaled", "[", "s_", "]"}], "\[RuleDelayed]", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"First", "@", "R"}], "+", 
                    RowBox[{"s", "*", 
                    RowBox[{"(", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Last", "@", "R"}], "-", 
                    RowBox[{"First", "@", "R"}]}], ")"}], ")"}]}]}], 
                   ")"}]}]}], "]"}], ",", "\n", "\t", "\t\t\t\t\t\t\t\t", 
               RowBox[{"First", "@", "R"}]}], "\n", "\t", "\t\t\t\t\t\t\t\t", 
              "}"}]}]}], ",", "\n", "\t", "\t\t\t\t\t", 
           RowBox[{"rMaxS", "=", "\n", "\t", "\t\t\t\t\t\t", 
            RowBox[{"Min", "@", 
             RowBox[{"{", "\n", "\t", "\t\t\t\t\t\t\t\t", 
              RowBox[{
               RowBox[{"Replace", "[", 
                RowBox[{
                 RowBox[{"rangeStart", "[", 
                  RowBox[{"[", 
                   RowBox[{"1", ",", "2"}], "]"}], "]"}], ",", 
                 RowBox[{
                  RowBox[{"Scaled", "[", "s_", "]"}], "\[RuleDelayed]", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"First", "@", "R"}], "+", 
                    RowBox[{"s", "*", 
                    RowBox[{"(", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Last", "@", "R"}], "-", 
                    RowBox[{"First", "@", "R"}]}], ")"}], ")"}]}]}], 
                   ")"}]}]}], "]"}], ",", "\n", "\t", "\t\t\t\t\t\t\t\t", 
               RowBox[{"Last", "@", "R"}]}], "\n", "\t", "\t\t\t\t\t\t\t\t", 
              "}"}]}]}], ",", "\n", "\t", "\t\t\t\t\t", 
           RowBox[{"hMinS", "=", "\n", "\t", "\t\t\t\t\t\t", 
            RowBox[{"Max", "@", 
             RowBox[{"{", "\n", "\t", "\t\t\t\t\t\t\t\t", 
              RowBox[{
               RowBox[{"Replace", "[", 
                RowBox[{
                 RowBox[{"rangeStart", "[", 
                  RowBox[{"[", 
                   RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", 
                 RowBox[{
                  RowBox[{"Scaled", "[", "s_", "]"}], "\[RuleDelayed]", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"First", "@", "M"}], "+", 
                    RowBox[{"s", "*", 
                    RowBox[{"(", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Last", "@", "M"}], "-", 
                    RowBox[{"First", "@", "M"}]}], ")"}], ")"}]}]}], 
                   ")"}]}]}], "]"}], ",", "\n", "\t", "\t\t\t\t\t\t\t\t", 
               RowBox[{"First", "@", "M"}]}], "\n", "\t", "\t\t\t\t\t\t\t\t", 
              "}"}]}]}], ",", "\n", "\t", "\t\t\t\t\t", 
           RowBox[{"hMaxS", "=", "\n", "\t", "\t\t\t\t\t\t", 
            RowBox[{"Max", "@", 
             RowBox[{"{", "\n", "\t", "\t\t\t\t\t\t\t\t", 
              RowBox[{
               RowBox[{"Replace", "[", 
                RowBox[{
                 RowBox[{"rangeStart", "[", 
                  RowBox[{"[", 
                   RowBox[{"2", ",", "2"}], "]"}], "]"}], ",", 
                 RowBox[{
                  RowBox[{"Scaled", "[", "s_", "]"}], "\[RuleDelayed]", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"First", "@", "M"}], "+", 
                    RowBox[{"s", "*", 
                    RowBox[{"(", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Last", "@", "M"}], "-", 
                    RowBox[{"First", "@", "M"}]}], ")"}], ")"}]}]}], 
                   ")"}]}]}], "]"}], ",", "\n", "\t", "\t\t\t\t\t\t\t\t", 
               RowBox[{"Last", "@", "M"}]}], "\n", "\t", "\t\t\t\t\t\t\t\t", 
              "}"}]}]}]}], "\n", "\t", "\t\t\t\t\t", "}"}], ",", "\n", "\t", 
         "\t\t\t\t\t", 
         RowBox[{
          RowBox[{"DynamicModule", "[", "\n", "\t", "\t\t\t\t\t\t", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"rRange", ",", "hRange", ",", "applyUpdates"}], "}"}], 
            ",", "\n", "\t\t\t\t\t\t\t", 
            RowBox[{"Panel", "@", "\n", "\t", "\t\t\t\t\t\t\t", 
             RowBox[{"Grid", "[", 
              RowBox[{
               RowBox[{"{", "\n", "\t", "\t\t\t\t\t\t\t\t", 
                RowBox[{
                 RowBox[{"{", "\n", "\t", "\t\t\t\t\t\t\t\t\t", 
                  RowBox[{
                   RowBox[{"Panel", "[", "\n", "\t", "\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"Column", "[", "\n", "\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"{", "\n", "\t\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{
                    "EventHandler", "[", "\n", "\t\t\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{
                    "Dynamic", "[", "\n", "\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{
                    "applyUpdates", ";", "\n", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"plotF", "[", 
                    RowBox[{
                    RowBox[{"spectrum", "[", 
                    RowBox[{"rRange", ",", "hRange"}], "]"}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"ImageSize", "\[Rule]", "d"}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"PlotRange", "\[Rule]", 
                    RowBox[{"{", 
                    RowBox[{"rRange", ",", "hRange"}], "}"}]}], ",", "\n", 
                    "\t", "\t", "\t\t\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"PlotRangePadding", "\[Rule]", "0"}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t", "ops"}], "\n", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t", "]"}]}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"SynchronousUpdating", "\[Rule]", "False"}], ",", 
                    "\n", "\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"TrackedSymbols", "\[RuleDelayed]", 
                    RowBox[{"{", "applyUpdates", "}"}]}]}], "\n", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t", "]"}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"\"\<MouseClicked\>\"", "\[RuleDelayed]", 
                    RowBox[{"(", 
                    RowBox[{"applyUpdates", "=", 
                    RowBox[{"RandomReal", "[", "]"}]}], ")"}]}]}], "\n", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t\t\t", "]"}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    "EventHandler", "[", "\n", "\t\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"Grid", "[", 
                    RowBox[{
                    RowBox[{"{", "\n", "\t\t\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    "\"\<Scanning Range: \>\"", ",", "\n", "\t", "\t", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    "InputField", "[", "\n", "\t", "\t", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{
                    "Dynamic", "[", "\n", "\t", "\t", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"Round", "[", 
                    RowBox[{
                    RowBox[{"rRange", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", ".001"}], "]"}], ",",
                     "\n", "\t", "\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"rRange", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "=", 
                    RowBox[{"Max", "@", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"First", "@", "R"}], ",", "#"}], "}"}]}]}], ";"}],
                     "&"}]}], "]"}], ",", "\n", "\t", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t", "Number", ",", "\n", 
                    "\t", "\t", "\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"Appearance", "\[Rule]", "\"\<Frameless\>\""}]}], 
                    "]"}], ",", "\n", "\t", "\t", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    "InputField", "[", "\n", "\t", "\t", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{
                    "Dynamic", "[", "\n", "\t", "\t", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"Round", "[", 
                    RowBox[{
                    RowBox[{"rRange", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", ".001"}], "]"}], ",",
                     "\n", "\t", "\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"rRange", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "=", 
                    RowBox[{"Min", "@", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Last", "@", "R"}], ",", "#"}], "}"}]}]}], ";"}], 
                    "&"}]}], "]"}], ",", "\n", "\t", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t", "Number", ",", "\n", 
                    "\t", "\t", "\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"Appearance", "\[Rule]", "\"\<Frameless\>\""}]}], 
                    "]"}]}], "\n", "\t", "\t", "\t\t\t\t\t\t\t\t\t\t\t\t\t\t",
                     "}"}], ",", "\n", "\t", "\t", "\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"{", 
                    RowBox[{
                    "\"\<Intensity Range: \>\"", ",", "\n", "\t", "\t", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    "InputField", "[", "\n", "\t", "\t", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{
                    "Dynamic", "[", "\n", "\t", "\t", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"Round", "[", 
                    RowBox[{
                    RowBox[{"hRange", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", ".001"}], "]"}], ",",
                     "\n", "\t", "\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"hRange", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "=", 
                    RowBox[{"Max", "@", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"First", "@", "M"}], ",", "#"}], "}"}]}]}], ";"}],
                     "&"}]}], "]"}], ",", "\n", "\t", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t", "Number", ",", "\n", 
                    "\t", "\t", "\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"Appearance", "\[Rule]", "\"\<Frameless\>\""}]}], 
                    "]"}], ",", "\n", "\t", "\t", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    "InputField", "[", "\n", "\t", "\t", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{
                    "Dynamic", "[", "\n", "\t", "\t", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"Round", "[", 
                    RowBox[{
                    RowBox[{"hRange", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", ".001"}], "]"}], ",",
                     "\n", "\t", "\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"hRange", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "=", 
                    RowBox[{"Min", "@", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Last", "@", "M"}], ",", "#"}], "}"}]}]}], ";"}], 
                    "&"}]}], "]"}], ",", "\n", "\t", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t", "Number", ",", "\n", 
                    "\t", "\t", "\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"Appearance", "\[Rule]", "\"\<Frameless\>\""}]}], 
                    "]"}]}], "}"}]}], "\n", "\t", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t\t\t", "}"}], ",", "\n", "\t", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"Alignment", "\[Rule]", "Left"}]}], "\n", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t\t\t", "]"}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"\"\<ReturnKeyDown\>\"", "\[RuleDelayed]", 
                    RowBox[{"(", 
                    RowBox[{"applyUpdates", "=", 
                    RowBox[{"RandomReal", "[", "]"}]}], ")"}]}]}], "\n", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t\t", "]"}]}], "\n", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t", "}"}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"Dividers", "\[Rule]", "Center"}]}], "\n", "\t", 
                    "\t\t\t\t\t\t\t\t\t\t", "]"}], ",", "\n", "\t", 
                    "\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"Background", "\[Rule]", "White"}]}], "\n", 
                    "\t\t\t\t\t\t\t\t\t\t", "]"}], ",", "\n", 
                   "\t\t\t\t\t\t\t\t\t\t", 
                   RowBox[{
                    RowBox[{"Control", "@", 
                    RowBox[{"{", "\n", "\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"hRange", ",", 
                    RowBox[{"{", 
                    RowBox[{"hMinS", ",", "hMaxS"}], "}"}], ",", "\"\<\>\""}],
                     "}"}], ",", 
                    RowBox[{"First", "@", "M"}], ",", 
                    RowBox[{"Last", "@", "M"}], ",", "\n", "\t", "\t", 
                    "\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"ImageSize", "\[Rule]", 
                    RowBox[{"{", 
                    RowBox[{"25", ",", 
                    RowBox[{"Last", "@", "d"}]}], "}"}]}], ",", "\n", "\t", 
                    "\t", "\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"ControlType", "\[Rule]", "IntervalSlider"}], ",",
                     "\n", "\t", "\t", "\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"ContinuousAction", "\[Rule]", "False"}], ",", 
                    "\n", "\t", "\t", "\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"Appearance", "\[Rule]", "\"\<Vertical\>\""}]}], 
                    "\n", "\t\t\t\t\t\t\t\t\t\t\t\t", "}"}]}], "~", 
                    "EventHandler", "~", 
                    RowBox[{"{", "\n", "\t\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"\"\<MouseUp\>\"", "\[RuleDelayed]", 
                    RowBox[{"(", 
                    RowBox[{"applyUpdates", "=", 
                    RowBox[{"RandomReal", "[", "]"}]}], ")"}]}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"PassEventsDown", "\[Rule]", "True"}]}], "\n", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t\t", "}"}]}]}], "\n", 
                  "\t\t\t\t\t\t\t\t\t\t\t\t\t", "\n", "\t\t\t\t\t\t\t\t\t\t", 
                  "}"}], ",", "\n", "\t\t\t\t\t\t\t\t\t", 
                 RowBox[{"{", "\n", "\t\t\t\t\t\t\t\t\t\t", 
                  RowBox[{
                   RowBox[{"Control", "@", 
                    RowBox[{"{", "\n", "\t", "\t", "\t", "\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"rRange", ",", 
                    RowBox[{"{", 
                    RowBox[{"rMinS", ",", "rMaxS"}], "}"}], ",", "\"\<\>\""}],
                     "}"}], ",", 
                    RowBox[{"First", "@", "R"}], ",", 
                    RowBox[{"Last", "@", "R"}], ",", "\n", "\t", "\t", "\t", 
                    "\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"ImageSize", "\[Rule]", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"First", "@", "d"}], ",", "25"}], "}"}]}], ",", 
                    "\n", "\t", "\t", "\t", "\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"ControlType", "\[Rule]", "IntervalSlider"}], ",",
                     "\n", "\t", "\t", "\t", "\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"ContinuousAction", "\[Rule]", "False"}]}], "\n", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t", "}"}]}], "~", "EventHandler", 
                   "~", 
                   RowBox[{"{", "\n", "\t\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"\"\<MouseUp\>\"", "\[RuleDelayed]", 
                    RowBox[{"(", 
                    RowBox[{"applyUpdates", "=", 
                    RowBox[{"RandomReal", "[", "]"}]}], ")"}]}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"PassEventsDown", "\[Rule]", "True"}]}], "\n", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t\t", "}"}]}], "\n", 
                  "\t\t\t\t\t\t\t\t\t\t", "}"}]}], "\n", "\t\t\t\t\t\t\t\t\t",
                 "}"}], ",", "\n", "\t\t\t\t\t\t\t\t\t", 
               RowBox[{"Alignment", "\[Rule]", 
                RowBox[{"{", 
                 RowBox[{"Left", ",", "Top"}], "}"}]}]}], "\n", "\t", 
              "\t\t\t\t\t\t\t\t", "]"}]}], ",", "\n", "\t", "\t\t\t\t\t\t", 
            RowBox[{"SynchronousInitialization", "\[Rule]", "False"}], ",", 
            "\n", "\t\t\t\t\t\t\t", 
            RowBox[{"SaveDefinitions", "\[Rule]", "False"}]}], "\n", 
           "\t\t\t\t\t\t\t", "]"}], "//", "Deploy"}]}], "\n", "\t\t\t\t\t\t", 
        "]"}]}], "\n", "\t\t\t\t", "]"}]}], "\n", "\t\t", "]"}]}], 
  ";"}]}], "CodeInput",
 CellChangeTimes->{{3.692545062885564*^9, 3.6925451182218657`*^9}, {
   3.692546121174065*^9, 3.692546121330741*^9}, {3.6925461933005323`*^9, 
   3.692546399956238*^9}, {3.692546444329301*^9, 3.692546492052746*^9}, 
   3.6925465221479588`*^9, {3.692546572699649*^9, 3.692546592595151*^9}, {
   3.6925466450919228`*^9, 3.6925466492691708`*^9}, {3.69254669256038*^9, 
   3.692546721198326*^9}, {3.6925467531154013`*^9, 3.692546782750926*^9}, {
   3.692546823709564*^9, 3.692546838865834*^9}, {3.692546924101214*^9, 
   3.6925469335394793`*^9}, {3.692547023955546*^9, 3.692547051976796*^9}, {
   3.692547131011273*^9, 3.692547140640513*^9}, 3.692547273459306*^9, {
   3.692547384959654*^9, 3.692547403011846*^9}, {3.692547441048815*^9, 
   3.692547501206338*^9}, {3.692547584889596*^9, 3.69254759338542*^9}, {
   3.6925476807778263`*^9, 3.692547837449996*^9}, {3.692547888522107*^9, 
   3.6925479111850433`*^9}, {3.69254805323204*^9, 3.692548166507259*^9}, {
   3.692548208514221*^9, 3.692548225656069*^9}, {3.6925482767240257`*^9, 
   3.692548277354185*^9}, {3.692548312584218*^9, 3.692548454769355*^9}, {
   3.6925484947298813`*^9, 3.692548558457313*^9}, {3.692548690257773*^9, 
   3.6925487221195107`*^9}, {3.6925487666188097`*^9, 3.692549030008174*^9}, {
   3.692549060539377*^9, 3.692549083185199*^9}, {3.6925492510469217`*^9, 
   3.6925493371780453`*^9}, {3.692549381166993*^9, 3.692549419379305*^9}, {
   3.692549450132043*^9, 3.692549693205385*^9}, {3.692549745111117*^9, 
   3.692549780236944*^9}, {3.692549812974393*^9, 3.692549990340683*^9}, {
   3.692550109037491*^9, 3.692550127312114*^9}, {3.692550178441023*^9, 
   3.692550276494862*^9}, {3.692550339134099*^9, 3.6925507409853487`*^9}, 
   3.692550813542149*^9, {3.6925508708388453`*^9, 3.692550894229773*^9}, {
   3.692550947076222*^9, 3.692550956813526*^9}, {3.692551000124752*^9, 
   3.692551003798066*^9}, {3.6925510472238483`*^9, 3.692551080438509*^9}, {
   3.692551130281241*^9, 3.6925511683734837`*^9}, {3.692551952355123*^9, 
   3.692552113968128*^9}, 3.692552250194817*^9, {3.6925522908109617`*^9, 
   3.692552344860888*^9}, {3.692552378395321*^9, 3.6925524371760807`*^9}, {
   3.692552641855139*^9, 3.6925526639808273`*^9}, {3.692552709707861*^9, 
   3.6925529278367977`*^9}, {3.692552964635367*^9, 3.692553003297995*^9}, {
   3.692553048592125*^9, 3.692553056193289*^9}, {3.6925530883830767`*^9, 
   3.6925531754925003`*^9}, {3.692553232412825*^9, 3.69255353392712*^9}, {
   3.692553575465601*^9, 3.6925535760812063`*^9}, {3.692553618448456*^9, 
   3.692553671868853*^9}, {3.692553729569564*^9, 3.69255375922281*^9}, {
   3.692553964010062*^9, 3.6925540183984327`*^9}, {3.692554281123765*^9, 
   3.6925542926999187`*^9}, {3.692554471773919*^9, 3.692554635637738*^9}, {
   3.6925548570232153`*^9, 3.692554950730009*^9}, {3.692555013461095*^9, 
   3.692555025357078*^9}, {3.6925575732688704`*^9, 3.692557624532596*^9}, {
   3.6925576576538258`*^9, 3.69255795239137*^9}, {3.692558025855132*^9, 
   3.6925580347332783`*^9}, {3.692558082018556*^9, 3.6925581556309967`*^9}, {
   3.692558325351795*^9, 3.6925583604867487`*^9}, {3.692558409833008*^9, 
   3.692558418577529*^9}, {3.692558475499621*^9, 3.692558527490407*^9}, {
   3.692558600712235*^9, 3.6925586107677402`*^9}, {3.6925586625308*^9, 
   3.69255867781776*^9}, {3.6925587233742123`*^9, 3.6925587351988087`*^9}, {
   3.692558781839747*^9, 3.692559020848628*^9}, {3.692559155899665*^9, 
   3.6925591585238247`*^9}, {3.692559192701552*^9, 3.692559272676043*^9}, {
   3.69255931973107*^9, 3.6925593392524157`*^9}, {3.692559436648149*^9, 
   3.692559443280073*^9}, {3.692559485606977*^9, 3.692559485772688*^9}, {
   3.6927063679100513`*^9, 3.692706371938973*^9}, {3.692724969090727*^9, 
   3.6927251469477987`*^9}, {3.6927314940808973`*^9, 3.692731512384388*^9}, {
   3.692731760994939*^9, 3.692731839033968*^9}, {3.692731967493517*^9, 
   3.692731985982205*^9}, {3.692732025636302*^9, 3.692732040463317*^9}, {
   3.692732085816539*^9, 3.692732089878212*^9}, {3.692732192236877*^9, 
   3.692732192610886*^9}, {3.692732333661099*^9, 3.692732475602282*^9}, {
   3.692732508174835*^9, 3.692732544161498*^9}, {3.6927325790832367`*^9, 
   3.6927325992156057`*^9}, {3.6927326368670807`*^9, 3.692732759431904*^9}, {
   3.692732799156736*^9, 3.692732862656961*^9}, {3.692732897028389*^9, 
   3.6927329300311623`*^9}, {3.69273298174634*^9, 3.692733038410234*^9}, {
   3.69273316778623*^9, 3.692733179053772*^9}, {3.692733317451252*^9, 
   3.6927334329035463`*^9}, {3.692733474992029*^9, 
   3.692733476669183*^9}},ExpressionUUID->"7113540d-38ac-4558-ac44-\
07852e3310b4"]
}, Closed]],

Cell[CellGroupData[{

Cell["\[LeftCeiling]LineStore\[RightFloor]", "CodeSubsubsection",
 Evaluatable->True,
 CellChangeTimes->{{3.6942153957482433`*^9, 3.69421539721105*^9}, {
  3.694255767010961*^9, 
  3.6942557695009193`*^9}},ExpressionUUID->"f9581dae-cdaa-4ee7-8730-\
03f74e56d0a6"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ChemSpectrumLineStore", "[", 
    RowBox[{
    "sym_", ",", "pos_", ",", "scaling_", ",", "spectra_", ",", "\n", "\t", 
     RowBox[{"selectFrom", ":", 
      RowBox[{
      "_InterpolatingFunction", "|", "_Composition", "|", "_Integer"}], ":", 
      "1"}]}], "\n", "\t", "]"}], ":=", 
   RowBox[{"(", "\n", "\t\t", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"MatchQ", "[", 
        RowBox[{"sym", ",", "_Symbol"}], "]"}], ",", 
       RowBox[{"sym", "=", 
        RowBox[{"{", "}"}]}]}], "]"}], ";", "\n", "\t", "\t", 
     RowBox[{"AppendTo", "[", 
      RowBox[{"sym", ",", "\n", "\t\t\t", 
       RowBox[{"Replace", "[", 
        RowBox[{"selectFrom", ",", 
         RowBox[{"{", "\n", "\t\t\t\t", 
          RowBox[{
           RowBox[{
            RowBox[{"f", ":", 
             RowBox[{"(", 
              RowBox[{"First", "@*", "First", "@*", "_NearestFunction"}], 
              ")"}]}], ":>", "\n", "\t\t\t\t\t", 
            RowBox[{"f", "@", "pos"}]}], ",", "\n", "\t\t\t\t", 
           RowBox[{"e_", ":>", "\n", "\t\t\t\t\t", 
            RowBox[{"ChemSpectrumNearestPeak", "[", "\n", "\t\t\t\t\t\t", 
             RowBox[{
              RowBox[{"Replace", "[", 
               RowBox[{
               "selectFrom", ",", "\n", "\t", "\t", "\t", "\t\t\t\t", 
                RowBox[{"i_Integer", ":>", 
                 RowBox[{"spectra", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}]}], "\n", "\t", "\t", "\t", 
               "\t\t\t\t", "]"}], ",", "\n", "\t", "\t", "\t", "\t\t\t", 
              "pos"}], "]"}]}]}], "\n", "\t\t\t\t", "}"}]}], "]"}]}], "\n", 
      "\t\t\t", "]"}]}], "\n", "\t\t", ")"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ChemSpectrumLineStore", "[", 
     RowBox[{"sym_", ",", "\n", "\t", 
      RowBox[{"selectFrom", ":", 
       RowBox[{
       "_Composition", "|", "_InterpolatingFunction", "|", "_Integer"}], ":", 
       "1"}]}], "]"}], "[", "a___", "]"}], ":=", "\n", "\t", 
   RowBox[{"ChemSpectrumLineStore", "[", 
    RowBox[{"sym", ",", "a", ",", "selectFrom"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"ChemSpectrumLineStore", "~", "SetAttributes", "~", "HoldFirst"}], 
  ";"}]}], "CodeInput",
 CellChangeTimes->{{3.694206253433392*^9, 3.694206353228972*^9}, {
  3.694215035756522*^9, 3.694215220696947*^9}, {3.694215341476959*^9, 
  3.694215370186327*^9}, {3.694215983627857*^9, 3.694215995586297*^9}, {
  3.694216076498149*^9, 3.694216144991806*^9}, {3.694255368705681*^9, 
  3.6942553704223433`*^9}, {3.694255634525524*^9, 
  3.6942556365226583`*^9}},ExpressionUUID->"2df23f55-bb6e-4d3e-8753-\
067ff59c9b83"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ChemSpectrumLineStore", "/:", "\n", "\t", 
   RowBox[{"HoldPattern", "[", 
    RowBox[{"Normal", "@", 
     RowBox[{"ChemSpectrumLineStore", "[", 
      RowBox[{"s_", ",", "___"}], "]"}]}], "]"}], ":=", "\n", "\t\t", "s"}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"ChemSpectrumLineStore", "/:", "\n", "\t", 
   RowBox[{"HoldPattern", "[", 
    RowBox[{"ChemSpectrum", "@", 
     RowBox[{"ChemSpectrumLineStore", "[", 
      RowBox[{"s_", ",", "___"}], "]"}]}], "]"}], ":=", "\n", "\t\t", 
   RowBox[{"ChemSpectrum", "@", "s"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"ChemSpectrumLineStore", "/:", "\n", "\t", 
   RowBox[{"HoldPattern", "[", 
    RowBox[{"ChemSpectrumPlot", "[", 
     RowBox[{
      RowBox[{"ChemSpectrumLineStore", "[", 
       RowBox[{"s_", ",", "___"}], "]"}], ",", "ops___"}], "]"}], "]"}], ":=",
    "\n", "\t\t", 
   RowBox[{"ChemSpectrumPlotDiscrete", "[", "\n", "\t\t\t", 
    RowBox[{
     RowBox[{"AssociationThread", "[", "\n", "\t\t\t\t", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "\"\<Frequencies\>\"", ",", "\"\<Weights\>\"", ",", 
         "\"\<Transitions\>\""}], "}"}], ",", "\n", "\t", "\t\t\t", 
       RowBox[{"Append", "[", 
        RowBox[{
         RowBox[{"Thread", "[", 
          RowBox[{"s", ",", "List"}], "]"}], ",", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
            "}"}], ",", 
           RowBox[{"Length", "@", "s"}]}], "]"}]}], "]"}]}], "\n", "\t\t\t\t",
       "]"}], ",", "ops"}], "]"}]}], ";"}], "\n", 
 RowBox[{"\t"}]}], "CodeInput",
 CellChangeTimes->{{3.694255706185174*^9, 3.694255718119149*^9}, {
  3.6942557919567823`*^9, 3.694255796308687*^9}, {3.694257913192411*^9, 
  3.694257927151349*^9}, {3.694257967917494*^9, 
  3.694258097316416*^9}},ExpressionUUID->"b3f2295c-9960-44ce-9fd1-\
f6fecdfdf246"]
}, Closed]],

Cell[CellGroupData[{

Cell["\[LeftCeiling]LineSelector\[RightFloor]", "CodeSubsubsection",
 Evaluatable->True,
 CellChangeTimes->{{3.694206224939355*^9, 
  3.694206227738223*^9}},ExpressionUUID->"3b0b659f-e524-45bd-90d9-\
ff478ac1d96d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ChemSpectrumLineSelector", "[", "\n", "\t", 
   RowBox[{
   "spectrumA_ChemSpectrum", ",", "others___ChemSpectrum", ",", "\n", "\t", 
    RowBox[{"selectFunction", ":", "\n", "\t\t", 
     RowBox[{"Except", "[", 
      RowBox[{
      "_ChemSpectrum", "|", "_Rule", "|", "_RuleDelayed", "|", "_String"}], 
      "]"}], ":", "\n", "\t\t", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"Print", "[", "#1", "]"}], "&"}], ")"}]}], ",", "\n", "\t", 
    RowBox[{"ops", ":", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"_Rule", "|", "_RuleDelayed"}], ")"}], "..."}]}]}], "]"}], ":=",
   "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"spectra", "=", "\n", "\t", 
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"pr", "=", 
          RowBox[{"Last", "@", 
           RowBox[{"First", "@", 
            RowBox[{"FilterRules", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"ops", ",", 
                RowBox[{"PlotRange", "\[Rule]", "All"}]}], "}"}], ",", 
              "PlotRange"}], "]"}]}]}]}], "}"}], ",", "\n", "\t", 
        RowBox[{"MapThread", "[", "\n", "\t\t", 
         RowBox[{
          RowBox[{
           RowBox[{"Switch", "[", 
            RowBox[{"#2", ",", "\n", "\t\t\t", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"_", "?", "NumericQ"}], "|", 
                RowBox[{"-", "\[Infinity]"}], "|", "_Scaled"}], ",", 
               RowBox[{
                RowBox[{"_", "?", "NumericQ"}], "|", "\[Infinity]", "|", 
                "_Scaled"}]}], "}"}], ",", "\n", "\t\t\t\t", 
             RowBox[{"#", "[", 
              RowBox[{"All", ",", "#2"}], "]"}], ",", "\n", "\t\t\t", 
             RowBox[{
              RowBox[{"_", "?", "NumericQ"}], "|", "_Scaled"}], ",", "\n", 
             "\t\t\t\t", 
             RowBox[{"#", "[", 
              RowBox[{"All", ",", 
               RowBox[{"{", 
                RowBox[{"#2", ",", "\[Infinity]"}], "}"}]}], "]"}], ",", "\n",
              "\t\t\t", "_", ",", "\n", "\t\t\t\t", "#"}], "\n", "\t\t\t", 
            "]"}], "&"}], ",", "\n", "\t\t\t", 
          RowBox[{"{", "\n", "\t\t\t\t", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"spectrumA", ",", "others"}], "}"}], ",", "\n", 
            "\t\t\t\t", 
            RowBox[{"Switch", "[", 
             RowBox[{"pr", ",", "\n", "\t\t\t\t\t\t", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{"_", "?", "NumericQ"}], "|", 
                  RowBox[{"-", "\[Infinity]"}], "|", "_Scaled"}], ",", 
                 RowBox[{
                  RowBox[{"_", "?", "NumericQ"}], "|", "\[Infinity]", "|", 
                  "_Scaled"}]}], "}"}], "|", 
               RowBox[{"Except", "[", "_List", "]"}]}], ",", "\n", 
              "\t\t\t\t\t\t\t", 
              RowBox[{"ConstantArray", "[", 
               RowBox[{"pr", ",", 
                RowBox[{"Length", "@", 
                 RowBox[{"{", 
                  RowBox[{"spectrumA", ",", "others"}], "}"}]}]}], "]"}], ",",
               "\n", "\t\t\t\t\t\t", "_", ",", "\n", "\t\t\t\t\t\t\t", 
              RowBox[{"PadRight", "[", "\n", "\t\t\t\t\t\t\t\t", 
               RowBox[{
                RowBox[{"Take", "[", 
                 RowBox[{"pr", ",", 
                  RowBox[{"UpTo", "[", 
                   RowBox[{"Length", "@", 
                    RowBox[{"{", 
                    RowBox[{"spectrumA", ",", "others"}], "}"}]}], "]"}]}], 
                 "]"}], ",", "\n", "\t\t\t\t\t\t\t\t", 
                RowBox[{"Length", "@", 
                 RowBox[{"{", 
                  RowBox[{"spectrumA", ",", "others"}], "}"}]}], ",", "\n", 
                "\t\t\t\t\t\t\t\t", "All"}], "]"}]}], "\n", "\t\t\t\t\t\t", 
             "]"}]}], "\n", "\t\t\t\t", "}"}]}], "]"}]}], "\n", "\t\t", 
       "]"}]}], "}"}], ",", "\t", "\n", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"plots", "=", "\n", "\t\t", 
         RowBox[{"With", "[", 
          RowBox[{
           RowBox[{"{", "\n", "\t\t\t", 
            RowBox[{"ps", "=", 
             RowBox[{"Last", "@", 
              RowBox[{"First", "@", 
               RowBox[{"FilterRules", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"ops", ",", 
                   RowBox[{"PlotStyle", "\[Rule]", "Automatic"}]}], "}"}], 
                 ",", "PlotStyle"}], "]"}]}]}]}], "\n", "\t\t\t", "}"}], ",", 
           "\n", "\t\t\t", 
           RowBox[{"MapThread", "[", "\n", "\t\t\t\t", 
            RowBox[{
             RowBox[{
              RowBox[{"ChemSpectrumPlot", "[", "\n", "\t\t\t\t\t", 
               RowBox[{"#", ",", "\n", "\t\t\t\t\t", 
                RowBox[{"Sequence", "@@", 
                 RowBox[{"Join", "[", "\n", "\t\t\t\t\t\t", 
                  RowBox[{"#2", ",", "\n", "\t\t\t\t\t\t", 
                   RowBox[{"FilterRules", "[", 
                    RowBox[{
                    RowBox[{"{", "ops", "}"}], ",", "\n", "\t\t\t\t\t\t\t", 
                    RowBox[{"DeleteCases", "[", "\n", "\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"Keys", "@", 
                    RowBox[{"Merge", "[", 
                    RowBox[{
                    RowBox[{"{", "\n", "\t", "\t", "\t", "\t", "\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"Options", "@", "ChemSpectrumPlot"}], ",", "\n", 
                    "\t", "\t", "\t", "\t", "\t\t\t\t\t", 
                    RowBox[{"Options", "@", "ChemSpectrumPlotDiscrete"}]}], 
                    "\n", "\t", "\t", "\t", "\t", "\t\t\t\t\t", "}"}], ",", 
                    "\n", "\t\t\t\t\t\t\t\t\t", "First"}], "\n", 
                    "\t\t\t\t\t\t\t\t\t", "]"}]}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t", 
                    RowBox[{"PlotStyle", "|", "PlotRange"}]}], "\n", 
                    "\t\t\t\t\t\t\t\t", "]"}]}], "\n", "\t\t\t\t\t\t\t", 
                    "]"}]}], "\n", "\t\t\t\t\t\t", "]"}]}]}], "\n", 
               "\t\t\t\t\t", "]"}], "&"}], ",", "\n", "\t\t\t\t", 
             RowBox[{"{", "\n", "\t\t\t\t\t", 
              RowBox[{"spectra", ",", "\n", "\t\t\t\t\t", 
               RowBox[{"With", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"directives", "=", 
                   RowBox[{"(", 
                    RowBox[{
                    "_Symbol", "|", "_Directive", "|", "_Opacity", "|", 
                    "_Thickness", "|", "_RGBColor", "|", "_Hue"}], ")"}]}], 
                  "}"}], ",", "\n", "\t\t\t\t\t\t", 
                 RowBox[{"If", "[", "\n", "\t\t\t\t\t\t\t", 
                  RowBox[{
                   RowBox[{"TrueQ", "[", "\n", "\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"MatchQ", "[", 
                    RowBox[{"ps", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"directives", "|", 
                    RowBox[{"{", 
                    RowBox[{"directives", ".."}], "}"}]}], ")"}], ".."}], 
                    "}"}]}], "]"}], "&&", "\n", "\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"Length", "@", "ps"}], "\[Equal]", 
                    RowBox[{"Length", "@", "spectra"}]}]}], "\n", 
                    "\t\t\t\t\t\t\t\t", "]"}], ",", "\n", "\t\t\t\t\t\t\t", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Replace", "[", 
                    RowBox[{
                    RowBox[{"Flatten", "@", 
                    RowBox[{"{", "#", "}"}]}], ",", "\n", "\t", 
                    "\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"d", ":", 
                    RowBox[{"directives", "|", 
                    RowBox[{"{", 
                    RowBox[{"directives", ".."}], "}"}]}]}], ":>", "\n", "\t",
                     "\t\t\t\t\t\t\t\t", 
                    RowBox[{"(", 
                    RowBox[{"PlotStyle", "\[Rule]", "d"}], ")"}]}], ",", "\n",
                     "\t", "\t\t\t\t\t\t\t", "1"}], "]"}], "&"}], "/@", 
                    "ps"}], ",", "\n", "\t", "\t\t\t\t\t\t", 
                   RowBox[{"ConstantArray", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"PlotStyle", "\[Rule]", 
                    RowBox[{"Flatten", "@", 
                    RowBox[{"{", "ps", "}"}]}]}], "}"}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t", 
                    RowBox[{"Length", "@", "spectra"}]}], "\n", 
                    "\t\t\t\t\t\t\t\t", "]"}]}], "\n", "\t\t\t\t\t\t\t", 
                  "]"}]}], "\n", "\t\t\t\t\t\t", "]"}]}], "\n", "\t\t\t\t\t", 
              "}"}]}], "]"}]}], "\n", "\t\t\t", "]"}]}], ",", "\n", "\t", 
        RowBox[{"selF", "=", "\n", "\t\t", 
         RowBox[{"Replace", "[", 
          RowBox[{"selectFunction", ",", 
           RowBox[{"{", "\n", "\t\t\t", 
            RowBox[{
             RowBox[{"ChemSpectrumLineStore", "[", "s_", "]"}], ":>", "\n", 
             "\t\t\t\t", 
             RowBox[{"ChemSpectrumLineStore", "[", 
              RowBox[{"s", ",", 
               RowBox[{"Interpolation", "@", 
                RowBox[{"Last", "@", "spectra"}]}]}], "]"}]}], "\n", "\t\t\t",
             "}"}]}], "]"}]}], ",", "\n", "\t", 
        RowBox[{"R", "=", 
         RowBox[{"Range", "@", "spectrumA"}]}], ",", "\n", "\t", 
        RowBox[{"S", "=", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"Reverse", "@", 
           RowBox[{"Range", "@", "spectrumA"}]}]}]}], ",", "\n", "\t", 
        RowBox[{"M", "=", 
         RowBox[{"MinMax", "/@", "spectra"}]}], ",", "\n", "\t", 
        RowBox[{"makeDialog", "=", 
         RowBox[{"TrueQ", "@", 
          RowBox[{"Last", "@", 
           RowBox[{"First", "@", 
            RowBox[{"FilterRules", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"ops", ",", 
                RowBox[{"CreateDialog", "\[Rule]", "True"}]}], "}"}], ",", 
              "CreateDialog"}], "]"}]}]}]}]}], ",", "\n", "\t", 
        RowBox[{"cachedPoints", "=", "\n", "\t\t", 
         RowBox[{"Last", "@", 
          RowBox[{"First", "@", 
           RowBox[{"FilterRules", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"ops", ",", "\n", "\t\t\t", 
               RowBox[{"\"\<CachedPoints\>\"", "\[Rule]", "\n", "\t\t\t\t", 
                RowBox[{"Replace", "[", 
                 RowBox[{"selectFunction", ",", 
                  RowBox[{"{", "\n", "\t\t\t\t\t", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"c", ":", 
                    RowBox[{"ChemSpectrumLineStore", "[", 
                    RowBox[{"s_", ",", "___"}], "]"}]}], "\[RuleDelayed]", 
                    "c"}], ",", "\n", "\t\t\t\t\t", 
                    RowBox[{"_", "\[Rule]", 
                    RowBox[{"{", "}"}]}]}], "\n", "\t\t\t\t\t", "}"}]}], 
                 "]"}]}]}], "\n", "\t\t\t\t", "}"}], ",", 
             "\"\<CachedPoints\>\""}], "]"}]}]}]}], ",", "\n", "\t", 
        RowBox[{"singlePlot", "=", 
         RowBox[{"(", "\n", "\t\t", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "@", "spectra"}], "\[Equal]", "1"}], "||", "\n",
            "\t\t", 
           RowBox[{"TrueQ", "@", 
            RowBox[{"Last", "@", 
             RowBox[{"First", "@", 
              RowBox[{"FilterRules", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"ops", ",", 
                  RowBox[{"Overlay", "\[Rule]", "False"}]}], "}"}], ",", 
                "Overlay"}], "]"}]}]}]}]}], "\n", "\t\t", ")"}]}], ",", "\n", 
        "\t", 
        RowBox[{"WH", "=", "\n", "\t\t", 
         RowBox[{"Replace", "[", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{"First", "@", 
            RowBox[{"FilterRules", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"ops", ",", 
                RowBox[{"ImageSize", "\[Rule]", 
                 RowBox[{"{", 
                  RowBox[{"500", ",", "250"}], "}"}]}]}], "}"}], ",", 
              "ImageSize"}], "]"}]}], ",", 
           RowBox[{"{", "\n", "\t\t\t", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"ImageSize", "\[Rule]", 
                RowBox[{"{", 
                 RowBox[{"w_", ",", "h_"}], "}"}]}], ")"}], ":>", "\n", 
              "\t\t\t\t", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Replace", "[", 
                 RowBox[{"w", ",", 
                  RowBox[{
                   RowBox[{"Except", "[", "_Integer", "]"}], "\[RuleDelayed]",
                    "500"}]}], "]"}], ",", 
                RowBox[{"Replace", "[", 
                 RowBox[{"h", ",", 
                  RowBox[{
                   RowBox[{"Except", "[", "_Integer", "]"}], "\[RuleDelayed]",
                    "250"}]}], "]"}]}], "}"}]}], ",", "\n", "\t\t\t", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"ImageSize", "\[Rule]", "w_"}], ")"}], ":>", "\n", 
              "\t\t\t\t", 
              RowBox[{"{", "\n", "\t\t\t\t\t", 
               RowBox[{
                RowBox[{"Replace", "[", 
                 RowBox[{"w", ",", 
                  RowBox[{
                   RowBox[{"Except", "[", "_Integer", "]"}], "\[RuleDelayed]",
                    "500"}]}], "]"}], ",", "\n", "\t\t\t\t\t", 
                RowBox[{".5", "*", 
                 RowBox[{"Replace", "[", 
                  RowBox[{"w", ",", 
                   RowBox[{
                    RowBox[{"Except", "[", "_Integer", "]"}], 
                    "\[RuleDelayed]", "500"}]}], "]"}]}]}], "\n", 
               "\t\t\t\t\t", "}"}]}]}], "\n", "\t\t\t", "}"}]}], "]"}]}]}], 
       "}"}], ",", "\n", "\t", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"--", 
         RowBox[{"--", 
          RowBox[{"--", 
           RowBox[{"--", 
            RowBox[{"--", 
             RowBox[{"--", 
              RowBox[{"--", 
               RowBox[{"--", 
                RowBox[{"--", "Display"}]}]}]}]}]}]}]}]}], " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Window", "--"}], "--"}], "--"}], "--"}], "--"}], 
             "--"}], "--"}], "--"}], "--"}], "--"}]}], "*)"}], "\n", "\t", 
      RowBox[{
       RowBox[{"DynamicModule", "[", 
        RowBox[{
         RowBox[{"{", "\n", "\t\t", 
          RowBox[{"raster", ",", "update", ",", "\n", "\t\t", 
           RowBox[{"windowWidth", "=", 
            RowBox[{"First", "@", "WH"}]}], ",", "\n", "\t\t", 
           RowBox[{"windowHeight", "=", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Last", "@", "WH"}], ")"}], "*", 
             RowBox[{"If", "[", 
              RowBox[{"singlePlot", ",", "1", ",", 
               RowBox[{"Length", "@", "plots"}]}], "]"}]}]}], ",", "\n", 
           "\t\t", "r", ",", "m", ",", 
           RowBox[{"rOld", "=", "0"}], ",", "v", ",", 
           RowBox[{"vOld", "=", "0"}], ",", 
           RowBox[{"doFast", "=", "False"}], ",", 
           RowBox[{"failSize", "=", "0.01"}]}], "}"}], ",", "\n", "\t\t", 
         RowBox[{
          RowBox[{"Panel", "@", "\n", "\t\t\t", 
           RowBox[{"Grid", "@", 
            RowBox[{"{", "\n", "\t\t\t\t", 
             RowBox[{
              RowBox[{"{", "\n", "\t\t\t\t", 
               RowBox[{
                RowBox[{
                 RowBox[{"DynamicWrapper", "[", "\n", "\t\t\t\t\t", 
                  RowBox[{
                   RowBox[{"Dynamic", "[", "\n", "\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"update", ";", "\n", "\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"Overlay", "[", 
                    RowBox[{
                    RowBox[{"{", "\n", "\t\t\t\t\t\t\t", 
                    RowBox[{"(*", 
                    RowBox[{
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", "Main"}]}]}]}]}]}]}]}]}], " ", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Graphic", "--"}], "--"}], "--"}], "--"}], "--"}],
                     "--"}], "--"}], "--"}], "--"}], "--"}]}], "*)"}], "\n", 
                    "\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"Graphics", "[", "\n", "\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"Inset", "[", "\n", "\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"raster", "\n", "\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"(*", 
                    RowBox[{"ReplaceAll", "[", 
                    RowBox[{"raster", ",", "\n", "\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    "g_Graphics", "\[RuleDelayed]", "\n", 
                    "\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"Show", "[", 
                    RowBox[{"g", ",", "\n", "\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    "PlotRange", "\[Rule]", "\n", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"ReplacePart", "[", 
                    RowBox[{
                    RowBox[{"PlotRange", "@", "g"}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"1", "->", 
                    RowBox[{"Rescale", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"m", "-", 
                    RowBox[{"r", "/", "2"}]}], ",", 
                    RowBox[{"m", "+", 
                    RowBox[{"r", "/", "2"}]}]}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "1"}], "}"}], ",", "R"}], "]"}]}]}], 
                    "\n", "\t\t\t\t\t\t\t\t\t\t\t\t\t\t", "]"}]}]}], "\n", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t", "]"}]}]}], "\n", 
                    "\t\t\t\t\t\t\t\t\t\t", "]"}], "*)"}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"Scaled", "@", 
                    RowBox[{"{", 
                    RowBox[{".5", ",", "0"}], "}"}]}], ",", 
                    RowBox[{"Scaled", "@", 
                    RowBox[{"{", 
                    RowBox[{"m", ",", "0"}], "}"}]}]}], "]"}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    "PlotRange", "\[Rule]", "\n", "\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"{", "\n", "\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "windowWidth"}], "}"}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "windowHeight"}], "}"}]}], "\n", 
                    "\t\t\t\t\t\t\t\t\t\t", "}"}]}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t", 
                    RowBox[{"ImagePadding", "\[Rule]", "None"}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t", 
                    RowBox[{"ImageSize", "\[Rule]", 
                    RowBox[{"{", 
                    RowBox[{"windowWidth", ",", 
                    RowBox[{"windowHeight", "-", "25"}]}], "}"}]}], ",", "\n",
                     "\t\t\t\t\t\t\t\t", 
                    RowBox[{"AspectRatio", "\[Rule]", "Full"}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t", 
                    RowBox[{"PlotRangePadding", "\[Rule]", "None"}], ",", 
                    "\n", "\t\t\t\t\t\t\t\t", 
                    RowBox[{"Background", "\[Rule]", "White"}]}], "\n", 
                    "\t\t\t\t\t\t\t\t", "]"}], ",", "\n", "\t\t\t\t\t\t\t", 
                    RowBox[{"(*", 
                    RowBox[{
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", "Cursor"}]}]}]}]}]}]}]}]}], " ", "+", " ", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Labels", "--"}], "--"}], "--"}], "--"}], 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", "--"}]}]}]}]}]}]}], "*)"}], "\n", 
                    "\t\t\t\t\t\t\t", 
                    RowBox[{"Graphics", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"Thin", ",", 
                    RowBox[{"Opacity", "[", ".5", "]"}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t", 
                    RowBox[{"Line", "@", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{".5", ",", 
                    RowBox[{"(", 
                    RowBox[{"20", "/", "windowHeight"}], ")"}]}], "}"}], ",", 
                    
                    RowBox[{"{", 
                    RowBox[{".5", ",", "1"}], "}"}]}], "}"}]}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t", 
                    RowBox[{"GrayLevel", "[", ".3", "]"}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t", 
                    RowBox[{"Inset", "[", "\n", "\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"Rescale", "[", 
                    RowBox[{"m", ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "1"}], "}"}], ",", "R"}], "]"}], ",", 
                    "\n", "\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"{", 
                    RowBox[{".5", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"Center", ",", "Bottom"}], "}"}]}], "]"}], ",", 
                    "\n", "\t\t\t\t\t\t\t\t", 
                    RowBox[{"Inset", "[", "\n", "\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"Rescale", "[", 
                    RowBox[{
                    RowBox[{"m", "-", 
                    RowBox[{"r", "/", "2"}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "1"}], "}"}], ",", "R"}], "]"}], ",", 
                    "\n", "\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"Left", ",", "Bottom"}], "}"}]}], "]"}], ",", 
                    "\n", "\t\t\t\t\t\t\t\t", 
                    RowBox[{"Inset", "[", "\n", "\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"Rescale", "[", 
                    RowBox[{
                    RowBox[{"m", "+", 
                    RowBox[{"r", "/", "2"}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "1"}], "}"}], ",", "R"}], "]"}], ",", 
                    "\n", "\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"Right", ",", "Bottom"}], "}"}]}], "]"}], ",", 
                    "\n", "\t\t\t\t\t\t\t\t", "Green", ",", "\n", 
                    "\t\t\t\t\t\t\t\t", 
                    RowBox[{"Replace", "[", "\n", "\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"Map", "[", "\n", "\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"Between", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"Rescale", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"m", "-", 
                    RowBox[{"r", "/", "2"}]}], ",", 
                    RowBox[{"m", "+", 
                    RowBox[{"r", "/", "2"}]}]}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "1"}], "}"}], ",", "R"}], "]"}]}], 
                    "]"}], ",", "\n", "\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"{", 
                    RowBox[{"#", ",", 
                    RowBox[{"(", 
                    RowBox[{"25", "/", "windowHeight"}], ")"}]}], "}"}], ",", 
                    "\n", "\t\t\t\t\t\t\t\t\t\t\t", "Nothing"}], "\n", 
                    "\t\t\t\t\t\t\t\t\t\t\t", "]"}], "&"}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"Replace", "[", 
                    RowBox[{
                    RowBox[{"Normal", "@", "cachedPoints"}], ",", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"f_", ",", "_"}], "}"}], "\[RuleDelayed]", "f"}], 
                    ",", "1"}], "]"}]}], "\n", "\t\t\t\t\t\t\t\t\t\t", "]"}], 
                    ",", 
                    RowBox[{"{", "\n", "\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"l", ":", 
                    RowBox[{"{", "__", "}"}]}], "\[RuleDelayed]", 
                    RowBox[{"Point", "@", "l"}]}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"_", "\[RuleDelayed]", "Nothing"}]}], "\n", 
                    "\t\t\t\t\t\t\t\t\t\t", "}"}]}], "\n", 
                    "\t\t\t\t\t\t\t\t\t", "]"}]}], "\n", "\t\t\t\t\t\t\t\t", 
                    "}"}], ",", "\n", "\t\t\t\t\t\t\t\t", 
                    RowBox[{"PlotRange", "\[Rule]", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "1"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "1"}], "}"}]}], "}"}]}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t", 
                    RowBox[{"ImageSize", "\[Rule]", 
                    RowBox[{"{", 
                    RowBox[{"windowWidth", ",", "windowHeight"}], "}"}]}], 
                    ",", "\n", "\t\t\t\t\t\t\t\t", 
                    RowBox[{"AspectRatio", "\[Rule]", "Full"}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t", 
                    RowBox[{"ImagePadding", "\[Rule]", "None"}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t", 
                    RowBox[{"ImageMargins", "\[Rule]", "None"}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t", 
                    RowBox[{"PlotRangePadding", "\[Rule]", "None"}]}], "\n", 
                    "\t\t\t\t\t\t\t\t", "]"}]}], "\n", "\t\t\t\t\t\t\t", 
                    "}"}], ",", "\n", "\t\t\t\t\t\t\t", 
                    RowBox[{"ImageSize", "\[Rule]", 
                    RowBox[{"{", 
                    RowBox[{"windowWidth", ",", "windowHeight"}], "}"}]}], 
                    ",", "\n", "\t\t\t\t\t\t\t", 
                    RowBox[{"Alignment", "\[Rule]", 
                    RowBox[{"{", 
                    RowBox[{"Center", ",", "Top"}], "}"}]}]}], "\n", 
                    "\t\t\t\t\t\t\t", "]"}], "//", 
                    RowBox[{
                    RowBox[{"Framed", "[", 
                    RowBox[{"#", ",", "\n", "\t\t\t\t\t\t\t\t", 
                    RowBox[{"Background", "\[Rule]", "White"}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t", 
                    RowBox[{"FrameStyle", "\[Rule]", 
                    RowBox[{"GrayLevel", "[", ".75", "]"}]}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t", 
                    RowBox[{"BaseStyle", "\[Rule]", "\"\<Panel\>\""}]}], 
                    "]"}], "&"}]}]}], ",", "\n", "\t\t\t\t\t\t\t", 
                    RowBox[{"TrackedSymbols", "\[RuleDelayed]", 
                    RowBox[{"{", 
                    RowBox[{"m", ",", "raster"}], "}"}]}]}], "\n", 
                    "\t\t\t\t\t\t", "]"}], ",", "\n", "\t\t\t\t\t", 
                   RowBox[{"(*", 
                    RowBox[{
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"-", "Generate"}]}]}]}]}]}]}]}]}], " ", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Graphic", "--"}], "--"}], "--"}], "--"}], "--"}],
                     "--"}], "--"}], "--"}], "--"}], "--"}], "--"}], "--"}]}],
                     "*)"}], "\n", "\t\t\t\t\t", 
                   RowBox[{"raster", "=", "\n", "\t\t\t\t\t\t", 
                    RowBox[{"With", "[", 
                    RowBox[{
                    RowBox[{"{", "\n", "\t\t\t\t\t\t\t", 
                    RowBox[{"dims", "=", 
                    RowBox[{"{", "\n", "\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"windowWidth", "/", "r"}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"windowHeight", "/", 
                    RowBox[{"If", "[", 
                    RowBox[{"singlePlot", ",", "1", ",", 
                    RowBox[{"Length", "@", "plots"}]}], "]"}]}], ")"}], "-", 
                    "10"}]}], "\n", "\t\t\t\t\t\t\t\t", "}"}]}], "\n", 
                    "\t\t\t\t\t\t\t", "}"}], ",", "\n", "\t\t\t\t\t\t\t", 
                    RowBox[{"With", "[", 
                    RowBox[{
                    RowBox[{"{", "\n", "\t\t\t\t\t\t\t\t", 
                    RowBox[{"baseOps", "=", 
                    RowBox[{"{", "\n", "\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"ImageSize", "\[Rule]", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"First", "@", "dims"}], ",", 
                    RowBox[{"Last", "@", "dims"}]}], "}"}]}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"AspectRatio", "\[Rule]", "Full"}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"ImagePadding", "\[Rule]", "All"}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"Ticks", "\[Rule]", "None"}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"Background", "\[Rule]", "White"}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"Axes", "->", 
                    RowBox[{"{", 
                    RowBox[{"True", ",", "False"}], "}"}]}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"ImageMargins", "\[Rule]", "None"}]}], "\n", 
                    "\t\t\t\t\t\t\t\t\t", "}"}]}], "\n", "\t\t\t\t\t\t\t\t", 
                    "}"}], ",", "\n", "\t\t\t\t\t\t\t", 
                    RowBox[{"With", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"graphic", "=", "\n", "\t\t\t\t\t\t\t\t", 
                    RowBox[{"If", "[", 
                    RowBox[{"singlePlot", ",", "\n", "\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"Show", "[", 
                    RowBox[{"plots", ",", "\n", "\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"Sequence", "@@", "baseOps"}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"PlotRange", "\[Rule]", 
                    RowBox[{"{", 
                    RowBox[{"R", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Min", "@", 
                    RowBox[{"Append", "[", 
                    RowBox[{
                    RowBox[{"M", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", "0"}], 
                    "]"}]}], ",", 
                    RowBox[{
                    RowBox[{"Max", "@", 
                    RowBox[{"M", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "*", "v"}]}], 
                    "}"}]}], "}"}]}]}], "\n", "\t\t\t\t\t\t\t\t\t\t", "]"}], 
                    ",", "\n", "\t\t\t\t\t\t\t\t", 
                    RowBox[{"Column", "@", "\n", "\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"Reverse", "@", 
                    RowBox[{"MapThread", "[", "\n", "\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Show", "[", 
                    RowBox[{"#", ",", "\n", "\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"Sequence", "@@", "baseOps"}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"PlotRange", "\[Rule]", 
                    RowBox[{"{", 
                    RowBox[{"R", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Min", "@", 
                    RowBox[{"Append", "[", 
                    RowBox[{
                    RowBox[{"First", "@", "#2"}], ",", "0"}], "]"}]}], ",", 
                    RowBox[{
                    RowBox[{"Last", "@", "#2"}], "*", "v"}]}], "}"}]}], 
                    "}"}]}]}], "\n", "\t\t\t\t\t\t\t\t\t\t\t", "]"}], "&"}], 
                    ",", "\n", "\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"{", 
                    RowBox[{"plots", ",", "M"}], "}"}]}], "\n", 
                    "\t\t\t\t\t\t\t\t\t\t", "]"}]}]}]}], "\n", 
                    "\t\t\t\t\t\t\t\t\t", "]"}]}], "\n", "\t\t\t\t\t\t\t\t\t",
                     "}"}], ",", "\n", "\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{"makeDialog", ",", "\n", "\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"SetOptions", "[", 
                    RowBox[{
                    RowBox[{"EvaluationNotebook", "[", "]"}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    "WindowStatusArea", "\[Rule]", "\n", 
                    "\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"TemplateApply", "[", 
                    RowBox[{
                    "\"\<Horizontal Scaling: ``%| Vertical Scaling: ``%\>\"", 
                    ",", "\n", "\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"100", "*", 
                    RowBox[{"{", 
                    RowBox[{"r", ",", "v"}], "}"}]}]}], "\n", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t", "]"}]}]}], "\n", 
                    "\t\t\t\t\t\t\t\t\t\t\t", "]"}]}], "\n", 
                    "\t\t\t\t\t\t\t\t\t\t", "]"}], ";", "\n", 
                    "\t\t\t\t\t\t\t\t", 
                    RowBox[{"(*", 
                    RowBox[{
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"-", "Try"}]}]}]}]}]}]}]}]}], " ", "to", " ", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"rasterize", "--"}], "--"}], "--"}], "--"}], 
                    "--"}], "--"}], "--"}], "--"}], "--"}], "--"}], "--"}], 
                    "--"}]}], "*)"}], "\n", "\t\t\t\t\t\t\t\t", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"r", "<", "failSize"}], "||", 
                    RowBox[{"TrueQ", "@", "doFast"}]}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t\t", "graphic", ",", "\n", 
                    "\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"Quiet", "[", "\n", "\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"With", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"g", "=", "\n", "\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"Check", "[", "\n", "\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{
                    "Image", "[", "\n", "\t", "\t", "\t\t\t\t\t\t\t\t\t\t\t", 
                    
                    RowBox[{
                    RowBox[{"Rasterize", "[", 
                    RowBox[{"graphic", ",", "\"\<Image\>\""}], "]"}], ",", 
                    "\n", "\t", "\t", "\t", "\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"ImageSize", "\[Rule]", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"windowWidth", "/", "r"}], ",", "windowHeight"}], 
                    "}"}]}]}], "\n", "\t", "\t", "\t\t\t\t\t\t\t\t\t\t\t", 
                    "]"}], ",", "\n", "\t\t\t\t\t\t\t\t\t\t\t\t", "graphic"}],
                     "\n", "\t\t\t\t\t\t\t\t\t\t\t\t", "]"}]}], "}"}], ",", 
                    "\n", "\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "@", "$MessageList"}], ">", "0"}], ",", 
                    "\n", "\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"failSize", "=", "r"}]}], "\n", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t", "]"}], ";", "\n", 
                    "\t\t\t\t\t\t\t\t\t\t\t", "g"}]}], "\n", 
                    "\t\t\t\t\t\t\t\t\t\t\t", "]"}], "\n", 
                    "\t\t\t\t\t\t\t\t\t\t", "]"}]}], "\n", 
                    "\t\t\t\t\t\t\t\t\t", "]"}]}]}], "\n", "\t\t\t\t\t\t\t\t",
                     "]"}]}], "\n", "\t\t\t\t\t\t\t\t", "]"}]}], "\n", 
                    "\t\t\t\t\t\t\t", "]"}]}], ",", "\n", "\t\t\t\t\t\t\t", 
                   RowBox[{"TrackedSymbols", "\[RuleDelayed]", 
                    RowBox[{"{", 
                    RowBox[{"r", ",", "v", ",", "doFast"}], "}"}]}]}], "\n", 
                  "\t\t\t\t\t\t", "]"}], "//", "\n", "\t\t\t\t", 
                 RowBox[{"(*", 
                  RowBox[{
                   RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"-", "Plot"}]}]}]}]}]}]}]}]}], " ", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"EventHandler", "--"}], "--"}], "--"}], "--"}], 
                    "--"}], "--"}], "--"}], "--"}], "--"}], "--"}], "--"}], 
                    "--"}]}], "*)"}], "\n", "\t\t\t\t", 
                 RowBox[{
                  RowBox[{"EventHandler", "[", 
                   RowBox[{"#", ",", "\n", "\t\t\t\t\t", 
                    RowBox[{
                    "\"\<MouseClicked\>\"", "\[RuleDelayed]", "\n", 
                    "\t\t\t\t\t\t", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"SelectionMove", "[", 
                    RowBox[{
                    RowBox[{"EvaluationBox", "[", "]"}], ",", "All", ",", 
                    "Expression"}], "]"}], ";", "\n", "\t\t\t\t\t\t\t", 
                    RowBox[{"CurrentValue", "@", "\"\<ShiftKey\>\""}]}], ",", 
                    "\n", "\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"doFast", "=", "True"}], ";", "\n", 
                    "\t\t\t\t\t\t\t", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"CurrentValue", "@", "\"\<MouseClickCount\>\""}], 
                    ">", "1"}], ",", "\n", "\t\t\t\t\t\t\t\t", 
                    RowBox[{"CreateDialog", "[", "\n", "\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"raster", "/.", 
                    RowBox[{
                    "g_Graphics", "\[RuleDelayed]", "\n", "\t", 
                    "\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"With", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"pr", "=", 
                    RowBox[{"PlotRange", "@", "g"}]}], "}"}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"Show", "[", 
                    RowBox[{"g", ",", "\n", "\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    "ImageSize", "\[Rule]", "\n", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"{", 
                    RowBox[{"windowWidth", ",", 
                    RowBox[{"windowHeight", "/", 
                    RowBox[{"If", "[", 
                    RowBox[{"singlePlot", ",", "1", ",", 
                    RowBox[{"Length", "@", "plots"}]}], "]"}]}]}], "}"}]}], 
                    ",", "\n", "\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"PlotRange", "->", 
                    RowBox[{"{", "\n", "\t\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"Rescale", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"m", "-", 
                    RowBox[{"r", "/", "2"}]}], ",", 
                    RowBox[{"m", "+", 
                    RowBox[{"r", "/", "2"}]}]}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "1"}], "}"}], ",", 
                    RowBox[{"First", "@", "pr"}]}], "]"}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"Last", "@", "pr"}]}], "\n", "\t", 
                    "\t\t\t\t\t\t\t\t\t\t\t\t", "}"}]}]}], "]"}]}], "\n", 
                    "\t\t\t\t\t\t\t\t\t\t\t", "]"}]}]}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    "WindowMargins", "\[Rule]", "\n", "\t\t\t\t\t\t\t\t\t\t", 
                    
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"#", ",", "Automatic"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"Automatic", ",", "#2"}], "}"}]}], "}"}]}], "&"}],
                     "@@", 
                    RowBox[{
                    "CurrentValue", "[", "\"\<MousePosition\>\"", "]"}]}], 
                    ",", "\n", "\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"Selectable", "\[Rule]", "True"}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"WindowClickSelect", "\[Rule]", "True"}], ",", 
                    "\n", "\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"ShowSelection", "\[Rule]", "True"}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"Editable", "\[Rule]", "False"}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"Deployed", "\[Rule]", "False"}], ",", "\n", 
                    "\t\t\t\t\t\t\t\t\t", 
                    RowBox[{"ShowCellBracket", "\[Rule]", "True"}]}], "\n", 
                    "\t\t\t\t\t\t\t\t\t", "]"}]}], "\n", "\t\t\t\t\t\t\t\t", 
                    "]"}], ";"}]}], "\n", "\t\t\t\t\t\t\t", "]"}]}]}], "\n", 
                   "\t\t\t\t\t", "]"}], "&"}]}], ",", "\n", "\t\t\t", 
                RowBox[{"EventHandler", "[", "\n", "\t\t\t\t", 
                 RowBox[{
                  RowBox[{"Control", "@", 
                   RowBox[{"{", "\n", "\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"v", ",", "1"}], "}"}], ",", "1", ",", ".0001", 
                    ",", ".01", ",", "\n", "\t\t\t\t\t\t", 
                    RowBox[{"ControlType", "\[Rule]", "VerticalSlider"}], ",", 
                    RowBox[{"(*", "\n", "\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"ImageSize", "\[Rule]", "windowHeight"}], ","}], 
                    "*)"}], "\n", "\t\t\t\t\t\t", 
                    RowBox[{"ContinuousAction", "\[Rule]", "True"}]}], "\n", 
                    "\t\t\t\t\t\t", "}"}]}], ",", "\n", "\t\t\t\t", 
                  RowBox[{"{", "\n", "\t\t\t\t\t", 
                   RowBox[{
                    RowBox[{"\"\<MouseDown\>\"", "\[RuleDelayed]", 
                    RowBox[{"(", 
                    RowBox[{"doFast", "=", "True"}], ")"}]}], ",", "\n", "\t",
                     "\t\t\t\t", 
                    RowBox[{"\"\<MouseUp\>\"", "\[RuleDelayed]", 
                    RowBox[{"(", 
                    RowBox[{"doFast", "=", "False"}], ")"}]}], ",", "\n", 
                    "\t\t\t\t\t", 
                    RowBox[{"PassEventsDown", "\[Rule]", "True"}]}], "\n", 
                   "\t\t\t\t\t", "}"}]}], "\n", "\t\t\t\t", "]"}]}], "\n", 
               "\t\t\t\t", "}"}], ",", "\n", "\t\t", 
              RowBox[{"{", "\n", "\t\t\t", 
               RowBox[{"EventHandler", "[", "\n", "\t\t\t\t", 
                RowBox[{
                 RowBox[{"Control", "@", 
                  RowBox[{"{", "\n", "\t", "\t\t\t\t", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"r", ",", "1"}], "}"}], ",", "1", ",", ".0001", 
                    ",", ".01", ",", "\n", "\t\t\t\t\t", 
                    RowBox[{"ControlType", "\[Rule]", "Slider"}], ",", "\n", 
                    "\t\t\t\t\t", 
                    RowBox[{"ContinuousAction", "\[Rule]", "True"}], ",", 
                    "\n", "\t\t\t\t\t", 
                    RowBox[{"ImageSize", "\[Rule]", "windowWidth"}]}], "\n", 
                   "\t\t\t\t\t", "}"}]}], ",", "\n", "\t\t\t\t", 
                 RowBox[{"{", "\n", "\t\t\t\t\t", 
                  RowBox[{
                   RowBox[{"\"\<MouseDown\>\"", "\[RuleDelayed]", 
                    RowBox[{"(", 
                    RowBox[{"doFast", "=", "True"}], ")"}]}], ",", "\n", "\t",
                    "\t\t\t\t", 
                   RowBox[{"\"\<MouseUp\>\"", "\[RuleDelayed]", 
                    RowBox[{"(", 
                    RowBox[{"doFast", "=", "False"}], ")"}]}], ",", "\n", 
                   "\t\t\t\t\t", 
                   RowBox[{"PassEventsDown", "\[Rule]", "True"}]}], "\n", 
                  "\t\t\t\t\t", "}"}]}], "\n", "\t\t\t\t", "]"}], "}"}], ",", 
              "\n", "\t\t", 
              RowBox[{"{", "\n", "\t\t\t", 
               RowBox[{"Control", "@", 
                RowBox[{"{", "\n", "\t\t\t\t", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"m", ",", 
                    RowBox[{"Replace", "[", 
                    RowBox[{"m", ",", 
                    RowBox[{
                    RowBox[{"Except", "[", 
                    RowBox[{"_", "?", "NumericQ"}], "]"}], "\[RuleDelayed]", 
                    ".5"}]}], "]"}]}], "}"}], ",", "\n", "\t", "\t\t\t", "0", 
                  ",", "1", ",", "\n", "\t\t\t\t", 
                  RowBox[{"ControlType", "\[Rule]", "Slider"}], ",", "\n", 
                  "\t\t\t\t", 
                  RowBox[{"ContinuousAction", "\[Rule]", "True"}], ",", "\n", 
                  "\t\t\t\t", 
                  RowBox[{"ImageSize", "\[Rule]", "windowWidth"}]}], "\n", 
                 "\t\t\t\t", "}"}]}], "\n", "\t\t\t", "}"}]}], "\n", "\t\t", 
             "}"}]}]}], "//", "\n", "\t\t", 
          RowBox[{
           RowBox[{"EventHandler", "[", 
            RowBox[{
             RowBox[{"Deploy", "@", "#"}], ",", "\n", "\t\t\t", 
             RowBox[{"With", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"scalingFactor", "=", "\n", "\t\t\t\t", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"Which", "[", "\n", "\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"CurrentValue", "@", "\"\<CommandKey\>\""}], ",", 
                    "\n", "\t\t\t\t\t\t", "10", ",", "\n", "\t\t\t\t\t", 
                    RowBox[{"CurrentValue", "@", "\"\<OptionKey\>\""}], ",", 
                    "\n", "\t\t\t\t\t\t", "1000", ",", "\n", "\t\t\t\t\t", 
                    "True", ",", "\n", "\t\t\t\t\t\t", "100"}], "]"}], ")"}], 
                  "&"}]}], "}"}], ",", "\n", "\t\t\t", 
               RowBox[{"{", "\n", "\t\t\t\t", 
                RowBox[{
                 RowBox[{
                 "\"\<RightArrowKeyDown\>\"", "\[RuleDelayed]", "\n", 
                  "\t\t\t\t\t", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"TrueQ", "@", 
                    RowBox[{"CurrentValue", "[", "\"\<ShiftKey\>\"", "]"}]}], 
                    ",", "\n", "\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"doFast", "=", "True"}], ";", "\n", 
                    "\t\t\t\t\t\t", 
                    RowBox[{"(", 
                    RowBox[{"r", "=", 
                    RowBox[{"Max", "@", 
                    RowBox[{"{", 
                    RowBox[{".001", ",", 
                    RowBox[{"r", "-", 
                    RowBox[{"1", "/", 
                    RowBox[{"scalingFactor", "[", "]"}]}]}]}], "}"}]}]}], 
                    ")"}]}], ",", "\n", "\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"doFast", "=", "False"}], ")"}], ";", "\n", 
                    "\t\t\t\t\t\t", 
                    RowBox[{"(", 
                    RowBox[{"m", "=", 
                    RowBox[{"Min", "@", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"m", "+", 
                    RowBox[{"r", "/", 
                    RowBox[{"scalingFactor", "[", "]"}]}]}]}], "}"}]}]}], 
                    ")"}]}]}], "\n", "\t\t\t\t\t\t", "]"}]}], ",", "\n", 
                 "\t\t\t\t", 
                 RowBox[{
                 "\"\<LeftArrowKeyDown\>\"", "\[RuleDelayed]", "\n", 
                  "\t\t\t\t\t", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"TrueQ", "@", 
                    RowBox[{"CurrentValue", "[", "\"\<ShiftKey\>\"", "]"}]}], 
                    ",", "\n", "\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"doFast", "=", "True"}], ";", "\n", 
                    "\t\t\t\t\t\t", 
                    RowBox[{"(", 
                    RowBox[{"r", "=", 
                    RowBox[{"Min", "@", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"r", "+", 
                    RowBox[{"1", "/", 
                    RowBox[{"scalingFactor", "[", "]"}]}]}]}], "}"}]}]}], 
                    ")"}]}], ",", "\n", "\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"doFast", "=", "False"}], ")"}], ";", "\n", 
                    "\t\t\t\t\t\t", 
                    RowBox[{"(", 
                    RowBox[{"m", "=", 
                    RowBox[{"Max", "@", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "\n", "\t\t\t\t\t\t\t", 
                    RowBox[{"m", "-", 
                    RowBox[{"(", 
                    RowBox[{"r", "/", 
                    RowBox[{"scalingFactor", "[", "]"}]}], ")"}]}]}], 
                    "}"}]}]}], ")"}]}]}], "\n", "\t\t\t\t\t\t", "]"}]}], ",", 
                 "\n", "\t\t\t\t", 
                 RowBox[{
                 "\"\<UpArrowKeyDown\>\"", "\[RuleDelayed]", "\n", 
                  "\t\t\t\t\t", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"TrueQ", "@", 
                    RowBox[{"CurrentValue", "[", "\"\<ShiftKey\>\"", "]"}]}], 
                    ",", "\n", "\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"doFast", "=", "True"}], ";", "\n", 
                    "\t\t\t\t\t\t", 
                    RowBox[{"v", "=", 
                    RowBox[{"Max", "@", 
                    RowBox[{"{", 
                    RowBox[{"0.0001", ",", 
                    RowBox[{"v", "-", 
                    RowBox[{"(", 
                    RowBox[{"1", "/", 
                    RowBox[{"scalingFactor", "[", "]"}]}], ")"}]}]}], 
                    "}"}]}]}]}], ",", "\n", "\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"doFast", "=", "False"}], ")"}], ";"}]}], "\n", 
                   "\t\t\t\t\t\t", "]"}]}], ",", "\n", "\t\t\t\t", 
                 RowBox[{
                 "\"\<DownArrowKeyDown\>\"", "\[RuleDelayed]", "\n", 
                  "\t\t\t\t\t", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"TrueQ", "@", 
                    RowBox[{"CurrentValue", "[", "\"\<ShiftKey\>\"", "]"}]}], 
                    ",", "\n", "\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"doFast", "=", "True"}], ";", "\n", 
                    "\t\t\t\t\t\t", 
                    RowBox[{"(", 
                    RowBox[{"v", "=", 
                    RowBox[{"Min", "@", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"v", "+", 
                    RowBox[{"(", 
                    RowBox[{"1", "/", 
                    RowBox[{"scalingFactor", "[", "]"}]}], ")"}]}]}], 
                    "}"}]}]}], ")"}]}], ",", "\n", "\t\t\t\t\t\t", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"doFast", "=", "False"}], ")"}], ";"}]}], "\n", 
                   "\t\t\t\t\t\t", "]"}]}], ",", "\n", "\t\t\t\t", 
                 RowBox[{"\"\<ReturnKeyDown\>\"", "\[RuleDelayed]", 
                  RowBox[{"(", "\n", "\t\t\t\t\t", 
                   RowBox[{
                    RowBox[{"selF", "[", 
                    RowBox[{
                    RowBox[{"Rescale", "[", 
                    RowBox[{"m", ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "1"}], "}"}], ",", "R"}], "]"}], ",", 
                    "m", ",", 
                    RowBox[{"{", 
                    RowBox[{"spectrumA", ",", "others"}], "}"}]}], "]"}], ";",
                     "\n", "\t\t\t\t\t", 
                    RowBox[{"update", "=", 
                    RowBox[{"RandomReal", "[", "]"}]}]}], "\n", "\t\t\t\t\t", 
                   ")"}]}], ",", "\n", "\t\t\t\t", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{
                   "\"\<MenuCommand\>\"", ",", "\"\<HandleShiftReturn\>\""}], 
                   "}"}], ":>", "\n", "\t\t\t\t\t", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"doFast", "=", "True"}], ";"}], ")"}]}]}], "\n", 
                "\t\t\t\t", "}"}]}], "\n", "\t\t\t\t", "]"}]}], "\n", 
            "\t\t\t\t", "]"}], "&"}]}]}], "\n", "\t\t", "]"}], "//", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{"makeDialog", ",", "\n", "\t\t\t", 
          RowBox[{"CreateDialog", "[", 
           RowBox[{"#", ",", "\n", "\t\t\t\t", 
            RowBox[{"Sequence", "@@", 
             RowBox[{"FilterRules", "[", 
              RowBox[{
               RowBox[{"{", "ops", "}"}], ",", 
               RowBox[{"Options", "@", "CreateDialog"}]}], "]"}]}], ",", "\n",
             "\t\t\t\t", 
            RowBox[{"Selectable", "\[Rule]", "True"}], ",", "\n", "\t", "\t", 
            "\t", "\t", 
            RowBox[{"Editable", "\[Rule]", "False"}], ",", "\n", "\t", "\t", 
            "\t", "\t", 
            RowBox[{"Deployed", "\[Rule]", "False"}], ",", "\n", "\t", "\t", 
            "\t", "\t", 
            RowBox[{"ShowSelection", "\[Rule]", "False"}], ",", "\n", 
            "\t\t\t\t", 
            RowBox[{"WindowElements", "\[Rule]", 
             RowBox[{"{", "\"\<StatusArea\>\"", "}"}]}], ",", "\n", 
            "\t\t\t\t", 
            RowBox[{"NotebookEventActions", "\[Rule]", 
             RowBox[{"{", "\n", "\t\t\t\t\t", 
              RowBox[{
               RowBox[{"\"\<UpArrowKeyDown\>\"", "\[RuleDelayed]", "Null"}], 
               ",", "\n", "\t\t\t\t\t", 
               RowBox[{"\"\<DownArrowKeyDown\>\"", "\[RuleDelayed]", "Null"}],
                ",", "\n", "\t\t\t\t\t", 
               RowBox[{"PassEventsUp", "\[Rule]", "False"}]}], "\n", 
              "\t\t\t\t\t", "}"}]}]}], "\n", "\t\t\t\t", "]"}], ",", "\n", 
          "\t\t\t", "#"}], "\n", "\t\t\t", "]"}], "&"}]}]}], "\n", "\t", 
     "]"}]}], "\n", "\t", "]"}]}]], "CodeInput",
 CellChangeTimes->{{3.6941860852714376`*^9, 3.6941860963436537`*^9}, {
   3.694186204638138*^9, 3.694186246315735*^9}, {3.694186287181645*^9, 
   3.6941863810789623`*^9}, {3.6941864135779037`*^9, 3.694186440097644*^9}, {
   3.694186474013801*^9, 3.6941864775976152`*^9}, {3.694186550706182*^9, 
   3.694186829315707*^9}, {3.6941868641857862`*^9, 3.694186865567227*^9}, {
   3.6941869546571693`*^9, 3.694187140959313*^9}, {3.694187282426774*^9, 
   3.694187324976535*^9}, {3.694187368688376*^9, 3.694187549217869*^9}, {
   3.694187581791774*^9, 3.6941876493656178`*^9}, {3.6941876794054537`*^9, 
   3.694187691469325*^9}, {3.694187736247787*^9, 3.694187738318838*^9}, {
   3.6941877808691273`*^9, 3.694187784132411*^9}, {3.694187837901782*^9, 
   3.694187998038126*^9}, {3.694188073152978*^9, 3.6941881814500647`*^9}, {
   3.694188211630115*^9, 3.694188213284083*^9}, {3.6941893846374483`*^9, 
   3.69418941544938*^9}, {3.694189461139577*^9, 3.694189482942585*^9}, {
   3.694189527813726*^9, 3.694189564619488*^9}, {3.694189692316636*^9, 
   3.694189694979035*^9}, {3.694189749627845*^9, 3.694189808557723*^9}, {
   3.694189847358107*^9, 3.694189849699819*^9}, {3.694190005190775*^9, 
   3.6941900596862097`*^9}, {3.694190098590836*^9, 3.6941901276694717`*^9}, {
   3.694190288343563*^9, 3.694190557553423*^9}, {3.694190595924906*^9, 
   3.6941906181832447`*^9}, {3.694190651829914*^9, 3.69419065220467*^9}, {
   3.694190686960595*^9, 3.694190854469737*^9}, {3.694190896396748*^9, 
   3.694190918499206*^9}, {3.694190949812599*^9, 3.694190957658044*^9}, {
   3.694191008172515*^9, 3.694191042979433*^9}, {3.694191097325027*^9, 
   3.694191171403634*^9}, {3.694191208969307*^9, 3.6941912811407623`*^9}, {
   3.6941913148757887`*^9, 3.69419135139395*^9}, {3.694191435536147*^9, 
   3.694191501332664*^9}, {3.694191545787265*^9, 3.694191617133357*^9}, 
   3.6941916577407*^9, {3.694191734704541*^9, 3.6941918034365263`*^9}, {
   3.6941918380284348`*^9, 3.694191900833075*^9}, {3.694192551594101*^9, 
   3.694192639676044*^9}, {3.694192674555916*^9, 3.694192679361372*^9}, {
   3.6941927168093643`*^9, 3.694192717255834*^9}, {3.694192933374568*^9, 
   3.6941929914334784`*^9}, {3.694193062359874*^9, 3.6941931460595837`*^9}, {
   3.69419319206961*^9, 3.6941931989078712`*^9}, {3.694193236156114*^9, 
   3.694193417467834*^9}, {3.694193505603765*^9, 3.69419350575429*^9}, {
   3.694193716790214*^9, 3.694193724677465*^9}, {3.6941937790768347`*^9, 
   3.6941937824914103`*^9}, {3.6941938619604893`*^9, 3.694193911751589*^9}, {
   3.694193953569549*^9, 3.694193954889031*^9}, {3.694193988188539*^9, 
   3.694193995533162*^9}, {3.694194082075963*^9, 3.694194086897108*^9}, {
   3.6941941442066603`*^9, 3.694194157557729*^9}, {3.694194220172961*^9, 
   3.694194255484188*^9}, {3.694194308630155*^9, 3.694194342827166*^9}, {
   3.694194470591956*^9, 3.694194505299955*^9}, {3.694194545011639*^9, 
   3.694194556541615*^9}, {3.694194833765791*^9, 3.6941948961108503`*^9}, {
   3.694194958683919*^9, 3.6941949982853127`*^9}, {3.6941950322914047`*^9, 
   3.6941950783562727`*^9}, {3.694195108776731*^9, 3.694195158623158*^9}, {
   3.6941952327028303`*^9, 3.6941952672266827`*^9}, {3.694195312635702*^9, 
   3.694195424045232*^9}, 3.6941954846557827`*^9, {3.694195526124494*^9, 
   3.694195530416901*^9}, {3.69419560104038*^9, 3.694195759842196*^9}, {
   3.694195795351239*^9, 3.694195855398904*^9}, {3.694196548688395*^9, 
   3.6941966390176888`*^9}, {3.694196681292962*^9, 3.6941967004509077`*^9}, {
   3.694196737840692*^9, 3.694196780887157*^9}, {3.694196845031301*^9, 
   3.694196852108555*^9}, {3.694196899399653*^9, 3.694196904566684*^9}, {
   3.6941969628478193`*^9, 3.694196985541493*^9}, {3.69419701719153*^9, 
   3.694197101221332*^9}, {3.694197143154181*^9, 3.6941971860203648`*^9}, {
   3.694197218099588*^9, 3.694197231650544*^9}, {3.69419728718648*^9, 
   3.694197307319627*^9}, {3.694197371269161*^9, 3.694197381700369*^9}, {
   3.69419749430154*^9, 3.6941974999237213`*^9}, {3.6941975473338423`*^9, 
   3.6941975522834806`*^9}, {3.694197590382257*^9, 3.694197615843404*^9}, {
   3.6941976461094017`*^9, 3.694197655841424*^9}, {3.694197725286296*^9, 
   3.694197811519968*^9}, {3.694197869302821*^9, 3.694197874667471*^9}, {
   3.6941979716469584`*^9, 3.694197998633368*^9}, {3.694198101121817*^9, 
   3.694198133410923*^9}, {3.6941981786838007`*^9, 3.694198229993988*^9}, {
   3.6941983280422277`*^9, 3.694198675014264*^9}, {3.694198832531144*^9, 
   3.694198852121426*^9}, {3.6941988888998203`*^9, 3.694198897010374*^9}, {
   3.694198950081966*^9, 3.694198950272606*^9}, {3.6941990323069687`*^9, 
   3.6941990421855803`*^9}, {3.694199095164077*^9, 3.69419910022577*^9}, {
   3.6941992332281303`*^9, 3.694199362136406*^9}, {3.694199393203745*^9, 
   3.6941994531250896`*^9}, {3.694199519542102*^9, 3.694199525748395*^9}, {
   3.694199558841566*^9, 3.694199565060276*^9}, {3.694199718972155*^9, 
   3.694199750914639*^9}, {3.694199811003168*^9, 3.694199812426078*^9}, {
   3.694199868061029*^9, 3.694199927122286*^9}, {3.6942000506182747`*^9, 
   3.6942000624448223`*^9}, {3.694200103043284*^9, 3.694200123505004*^9}, {
   3.694200172645027*^9, 3.694200174643799*^9}, {3.69420026949752*^9, 
   3.6942004250409603`*^9}, {3.6942004992826777`*^9, 3.694200544755891*^9}, {
   3.694200608610558*^9, 3.6942006111517773`*^9}, {3.694200644053116*^9, 
   3.694200645922995*^9}, {3.694200700375827*^9, 3.694200754293914*^9}, {
   3.6942008517382917`*^9, 3.69420089432195*^9}, {3.694200961527894*^9, 
   3.6942010134177713`*^9}, {3.6942012184041758`*^9, 
   3.6942012435436773`*^9}, {3.694201320914322*^9, 3.694201327742733*^9}, {
   3.6942014083280573`*^9, 3.6942014347107553`*^9}, {3.694201587407687*^9, 
   3.694201595461389*^9}, {3.694201792252698*^9, 3.694201803324651*^9}, {
   3.694201852333942*^9, 3.694201931753313*^9}, {3.694202105339622*^9, 
   3.694202151600909*^9}, {3.6942028588595953`*^9, 3.694202890011916*^9}, {
   3.694202951216557*^9, 3.69420296118491*^9}, {3.694202992236899*^9, 
   3.694203044961123*^9}, {3.6942032319142933`*^9, 3.694203258271797*^9}, {
   3.694203413887609*^9, 3.694203452824651*^9}, {3.694203521215205*^9, 
   3.694203537317793*^9}, {3.694203590412314*^9, 3.694203635746376*^9}, 
   3.694203671365443*^9, {3.694203937606093*^9, 3.6942039806030817`*^9}, {
   3.694204028072817*^9, 3.694204118787105*^9}, {3.694204154068282*^9, 
   3.694204189833365*^9}, {3.6942043061500463`*^9, 3.694204385171912*^9}, {
   3.6942044350282183`*^9, 3.6942044924898987`*^9}, 3.694204530105744*^9, {
   3.694204642177503*^9, 3.694204647154148*^9}, {3.694204720258954*^9, 
   3.694204749000627*^9}, {3.694204792020907*^9, 3.694204811978835*^9}, {
   3.6942048811576977`*^9, 3.69420491019598*^9}, {3.694204952986706*^9, 
   3.694205027486524*^9}, {3.694205078730691*^9, 3.694205142267717*^9}, {
   3.694205195354476*^9, 3.694205218464736*^9}, {3.694205279993073*^9, 
   3.69420528235923*^9}, {3.694205363729834*^9, 3.694205382786462*^9}, {
   3.694205661675269*^9, 3.694205963813739*^9}, 3.694206064535762*^9, {
   3.694206185701787*^9, 3.694206194933281*^9}, {3.694206601583984*^9, 
   3.694206659617503*^9}, {3.694206719733027*^9, 3.694206824090213*^9}, {
   3.694206953000247*^9, 3.694207119212256*^9}, {3.6942071655532837`*^9, 
   3.69420720144055*^9}, {3.694207319992354*^9, 3.6942073319581223`*^9}, {
   3.694207467779297*^9, 3.694207475528954*^9}, {3.69420756667983*^9, 
   3.694207567485485*^9}, {3.694207823488669*^9, 3.694207868218083*^9}, {
   3.694208134532112*^9, 3.694208137115615*^9}, {3.694208347251148*^9, 
   3.694208352372189*^9}, {3.6942084909580603`*^9, 3.69420850882088*^9}, {
   3.694208547294215*^9, 3.694208551085565*^9}, {3.694215420333663*^9, 
   3.6942155609713497`*^9}, {3.694250829415288*^9, 3.694250894882625*^9}, 
   3.6942509823239727`*^9, {3.694251078589664*^9, 3.694251133147341*^9}, {
   3.69425119314116*^9, 3.694251275564451*^9}, {3.6942514793473186`*^9, 
   3.694251759363049*^9}, {3.694251796537784*^9, 3.69425193011131*^9}, {
   3.694251992633555*^9, 3.6942519936561193`*^9}, {3.694252042968816*^9, 
   3.694252046927186*^9}, {3.694252077778153*^9, 3.694252078992221*^9}, 
   3.694252214251424*^9, {3.6942523286575737`*^9, 3.69425233105645*^9}, {
   3.6942523768780193`*^9, 3.694252479383165*^9}, {3.694252533260398*^9, 
   3.694252578634467*^9}, {3.694252699308394*^9, 3.6942528360325823`*^9}, 
   3.694252951033049*^9, {3.694253014481572*^9, 3.694253077256691*^9}, {
   3.694253132972788*^9, 3.69425314234829*^9}, {3.6942531903732758`*^9, 
   3.694253192665304*^9}, {3.694253297572824*^9, 3.694253317559116*^9}, {
   3.694253596903068*^9, 3.6942536032647123`*^9}, {3.694253641959195*^9, 
   3.6942536427838507`*^9}, {3.694253794937999*^9, 3.694253804050416*^9}, {
   3.694253834841845*^9, 3.6942538562630177`*^9}, {3.694253893859353*^9, 
   3.694253906601796*^9}, {3.6942540230011463`*^9, 3.694254143483119*^9}, {
   3.694254180048553*^9, 3.694254207695868*^9}, {3.694254238159934*^9, 
   3.6942542458858347`*^9}, {3.69425440588772*^9, 3.694254413319648*^9}, {
   3.694254509562428*^9, 3.694254546837881*^9}, {3.694254641655712*^9, 
   3.694254689525354*^9}, {3.694254747254599*^9, 3.694254748663498*^9}, {
   3.6942547915359507`*^9, 3.694254799328368*^9}, {3.6942548845153723`*^9, 
   3.694254936034219*^9}, {3.694254978244878*^9, 3.6942550135785933`*^9}, {
   3.6942550901681843`*^9, 3.6942551048158817`*^9}, {3.694255158863133*^9, 
   3.694255165102235*^9}, {3.694255260070991*^9, 3.694255333413299*^9}, {
   3.694255437127283*^9, 3.694255700612547*^9}, {3.6942558990532227`*^9, 
   3.694255937275647*^9}, {3.6942560040785313`*^9, 3.6942560547035427`*^9}, {
   3.69425614325778*^9, 3.694256244193307*^9}, {3.6942563141136*^9, 
   3.694256315292013*^9}, {3.694257858713084*^9, 3.694257877856268*^9}, {
   3.694258439711544*^9, 3.694258468340819*^9}, {3.694258503367302*^9, 
   3.69425862313203*^9}, {3.694258661503396*^9, 3.694258696558776*^9}, {
   3.694258735399816*^9, 3.6942589016203012`*^9}, {3.694258952259907*^9, 
   3.694258955263246*^9}, {3.694258992863598*^9, 3.6942590349718647`*^9}, {
   3.694259079780937*^9, 3.694259101708441*^9}, {3.6942603065181303`*^9, 
   3.694260315838517*^9}, {3.6942603791256638`*^9, 3.6942603831247787`*^9}, {
   3.694260414435877*^9, 3.6942604760336533`*^9}, {3.6942605128091908`*^9, 
   3.694260535394093*^9}, {3.69426063864502*^9, 3.694260724881419*^9}, {
   3.6942608011140747`*^9, 3.6942608041381693`*^9}, {3.694260836763063*^9, 
   3.694260871459255*^9}, {3.694269690548606*^9, 3.6942697069202967`*^9}, {
   3.694269780176654*^9, 3.6942697822827377`*^9}, {3.694269821031663*^9, 
   3.694269822320801*^9}, {3.694269866078394*^9, 3.6942698667570667`*^9}, {
   3.694269913821621*^9, 3.6942699914303503`*^9}, {3.6942700892706137`*^9, 
   3.694270106821088*^9}, {3.694270212274168*^9, 3.6942703388546247`*^9}, {
   3.6942703720395927`*^9, 3.694270576043674*^9}, {3.694270618831661*^9, 
   3.694270642941165*^9}, {3.694270758690989*^9, 3.6942707706336184`*^9}, {
   3.694270801762187*^9, 3.694270836158072*^9}, {3.694270868638269*^9, 
   3.694270872212719*^9}, {3.694270905564724*^9, 3.694270981490284*^9}, {
   3.6942710330977507`*^9, 3.6942710466471663`*^9}, {3.694271087752195*^9, 
   3.694271130982266*^9}, {3.694271190964264*^9, 3.694271246371542*^9}, {
   3.6942714344765673`*^9, 3.694271504379401*^9}, {3.694271934480886*^9, 
   3.694271951825314*^9}, {3.6942720836883783`*^9, 3.694272278458788*^9}, {
   3.6942724662417107`*^9, 3.6942726608272*^9}, {3.6942726945854*^9, 
   3.694272718056376*^9}, {3.694272753252823*^9, 3.6942727901971073`*^9}, {
   3.6942728476769543`*^9, 3.694272848621014*^9}, {3.6942728849754972`*^9, 
   3.69427289359834*^9}, {3.6942729291920147`*^9, 3.6942730202664337`*^9}, {
   3.694273139072863*^9, 3.694273139415781*^9}, 3.694277177206417*^9, {
   3.694290419868247*^9, 3.6942904428699217`*^9}, {3.694290759494279*^9, 
   3.694290795660331*^9}, {3.6942908506271763`*^9, 3.6942908548272552`*^9}, {
   3.694296499954939*^9, 
   3.69429654911541*^9}},ExpressionUUID->"9ea79a74-a669-4acb-b1de-\
bc6f23fede05"]
}, Closed]]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"End", "[", "]"}], 
  ";"}]], "InputSection",ExpressionUUID->"9dac5ffd-3497-409e-be10-\
a60ab050c12b"]
}, Open  ]],

Cell["", "SectionSeparator",ExpressionUUID->"7caa748b-78fc-4082-aded-\
e57495d40106"]
},
WindowSize->{808, 755},
WindowMargins->{{72, Automatic}, {Automatic, 0}},
FrontEndVersion->"11.3 for Mac OS X x86 (32-bit, 64-bit Kernel) (March 5, \
2018)",
StyleDefinitions->FrontEnd`FileName[{"BTools"}, "CodePackage.nb", 
  CharacterEncoding -> "UTF-8"]
]

